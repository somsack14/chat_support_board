"use strict";!function(e){function t(e,t=!1){var i=S.find(".sb-info-card");t?"error"==t?i.addClass("sb-info-card-error"):i.addClass("sb-info-card-info"):(i.removeClass("sb-info-card-error sb-info-card-warning sb-info-card-info"),clearTimeout(J),J=setTimeout(()=>{i.sbActive(!1)},5e3)),i.html(`<h3>${o(e)}</h3>`).sbActive(!0)}function i(e){if(typeof e==me)return window.sb_current_user;window.sb_current_user=e}function s(t,i,s=!1,a="",n="",r=!1){let l=S.find(".sb-dialog-box").attr("data-type",i),c=l.find("p");l.attr("id",a).setClass("sb-scroll-area",r).css("height",r?parseInt(e(window).height())-200+"px":""),l.find(".sb-title").html(n),c.html(("alert"==i?o("Are you sure?")+" ":"")+o(t)),l.sbActive(!0).css({"margin-top":l.outerHeight()/-2+"px","margin-left":l.outerWidth()/-2+"px"}),K.sbActive(!0),X=s,setTimeout(()=>{Fe.open_popup=l},500)}function a(t=!0,i=!0){S.find(".sb-loading-global").sbActive(t),i&&(K.sbActive(t),e("body").setClass("sb-lightbox-active",t))}function n(t){return!!e(t).sbLoading()||(e(t).sbLoading(!0),!1)}function o(e){return SB_TRANSLATIONS&&e in SB_TRANSLATIONS?SB_TRANSLATIONS[e]:e}function r(){typeof caches!==me&&caches.delete("sb-pwa-cache")}function l(t,i){let s=(t=e(t)).find("> div, > ul");s.css({height:"","max-height":""}),t.hasClass("sb-collapse")&&e(s).prop("scrollHeight")>i&&(t.sbActive(!0).attr("data-height",i),t.find(".sb-collapse-btn").remove(),t.append(`<a class="sb-btn-text sb-collapse-btn">${o("View more")}</a>`),s.css({height:i+"px","max-height":i+"px"}))}function c(t,i){let s=e(t).parent().find("i"),a=e(t).val();s.sbLoading()||SBF.search(a,()=>{s.sbLoading(!0),i(a,s)})}function d(t,i=!1,s=0){if(i)return e(t).scrollTop()+e(t).innerHeight()>=e(t)[0].scrollHeight-1;e(t).scrollTop(e(t)[0].scrollHeight-s)}function u(e){ve||window.history.pushState("","",e)}function p(){return SB_ADMIN_SETTINGS.cloud?"&cloud="+SB_ADMIN_SETTINGS.cloud.token:""}function h(e){return e.replace("https://","").replace("http://","").replace("www.","").replace(/\/$/,"")}function f(t=!1){if(!xe){if(!1===ye)return ye=!0,void e.getScript(SB_URL+"/vendor/editorjs.js",()=>{f(t)});g(),xe=!0,ye=new EditorJS({data:"string"==typeof t?{time:Date.now(),blocks:[t?{id:"sb",type:"raw",data:{html:t}}:{id:"sb",type:"paragraph",data:{text:""}}]}:t,tools:{list:{class:List,inlineToolbar:!0},image:{class:ImageTool,config:{uploader:{uploadByFile(t){let i=new FormData;return i.append("file",t),new Promise(t=>{e.ajax({url:SB_URL+"/include/upload.php",cache:!1,contentType:!1,processData:!1,data:i,type:"POST",success:function(e){"success"==(e=JSON.parse(e))[0]?t({success:1,file:{url:e[1]}}):console.log(e)}})})}}}},header:Header,code:CodeTool,raw:RawTool},onReady:()=>{xe=!1},minHeight:50})}}function b(e){let t="";return e.map(e=>{switch(e.type){case"header":t+=`<h${e.data.level}>${e.data.text}</h${e.data.level}>`;break;case"paragraph":t+=`<p>${e.data.text}</p>`;break;case"image":t+=`<img class="img-fluid" src="${e.data.file.url}" title="${e.data.caption}" /><em>${e.data.caption}</em>`;break;case"list":t+='<ul class="sb-ul-'+e.data.style+'">',e.data.items.forEach(function(e){t+=`<li>${e}</li>`}),t+="</ul>";break;case"code":t+=`<code>${e.data.code}</code>`;break;case"raw":t+=`<div class="bxc-raw-html">${e.data.html}</div>`}}),t}function g(){typeof ye.destroy!==me&&(ye.destroy(),ye=!1)}function m(e,t){if(e){if(0===e.indexOf("http")||0===e.indexOf("www"))return e;if(t=new URL(t),"//"==e.substring(0,2))return t.protocol+e;if("/"==e.charAt(0))return t.protocol+"//"+t.host+e;if(/^\s*$/.test(e))return"";for("./"==e.substring(0,2)&&(e="."+e),e=("/"==t.href.slice(-1)?t.href.slice(0,-1):t.href)+"/"+e;/\/\.\.\//.test(e=e.replace(/[^\/]+\/+\.\.\//g,"")););return e=e.replace(/\.$/,"").replace(/\/\./g,"").replace(/"/g,"%22").replace(/'/g,"%27").replace(/</g,"%3C").replace(/>/g,"%3E")}return""}function v(){SBF.ajax({function:"get-conversations"},e=>{0==e.length&&y.find(".sb-board").addClass("sb-no-conversation"),Ce.populateList(e),de&&y.find(".sb-admin-list").sbActive(!0),SBF.getURL("conversation")?(y.sbActive()||_.find(".sb-admin-nav #sb-conversations").click(),Ce.openConversation(SBF.getURL("conversation"))):de||SBF.getURL("user")||SBF.getURL("setting")||SBF.getURL("report")||SBF.getURL("area")&&"conversations"!=SBF.getURL("area")||Ce.clickFirst(),Ce.startRealTime(),Ce.datetime_last_conversation=SB_ADMIN_SETTINGS["now-db"],a(!1)}),SBPusher.initServiceWorker(),SB_ADMIN_SETTINGS["push-notifications"]&&SBPusher.initPushNotifications(),setInterval(function(){SBF.ajax({function:"get-active-user",db:!0},e=>{e||SBF.reset()})},36e5)}var S,_,y,w,x,B,k,A,T,C,$,F,I,L,E,N,M,R,D,j,U,G,P,O,H,V,q,W,z,J,X,Y,Z,K,Q,ee=[],te=!1,ie=!1,se=!1,ae=!1,ne=1,oe=1,re={},le=1,ce=1,de=e(window).width()<429,ue={last:0,header:!0,always_hidden:!1},pe="localhost"===location.hostname||"127.0.0.1"===location.hostname,he=new Date,fe=!1,be=!0,ge=!1,me="undefined",ve=!1,Se=!1,_e=!1,ye=!1,we=!1,xe=!1;e.fn.miniTip=function(t){var i=e.extend({title:"",content:!1,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:!0,maxW:"250px",offset:5,stemOff:0,doHide:!1},t);0==S.find("#miniTip").length&&S.append('<div id="miniTip" class="sb-tooltip"><div></div></div>');var s=S.find("#miniTip"),a=s.find("div");return i.doHide?(s.stop(!0,!0).fadeOut(i.fadeOut),!1):this.each(function(){var t=e(this),n=i.content?i.content:t.attr("title");if(""!=n&&void 0!==n){window.delay=!1;var o=!1,r=!0;i.content||t.removeAttr("title"),"hover"==i.event?(t.hover(function(){s.removeAttr("click"),r=!0,l.call(this)},function(){r=!1,c()}),i.aHide||s.hover(function(){o=!0},function(){o=!1,setTimeout(function(){!r&&!s.attr("click")&&c()},20)})):"click"==i.event&&(i.aHide=!0,t.click(function(){return s.attr("click","t"),s.data("last_target")!==t?l.call(this):"none"==s.css("display")?l.call(this):c(),s.data("last_target",t),e("html").unbind("click").click(function(t){"block"==s.css("display")&&!e(t.target).closest("#miniTip").length&&(e("html").unbind("click"),c())}),!1}));var l=function(){i.show&&i.show.call(this,i),i.content&&""!=i.content&&(n=i.content),a.html(n),i.render&&i.render(s),s.hide().width("").width(s.width()).css("max-width",i.maxW);var o=t.is("area");if(o){var r,l=[],c=[],d=t.attr("coords").split(",");function u(e,t){return e-t}for(r=0;r<d.length;r++)l.push(d[r++]),c.push(d[r]);var p=t.parent().attr("name"),h=e("img[usemap=\\#"+p+"]").offset(),f=parseInt(h.left,10)+parseInt((parseInt(l.sort(u)[0],10)+parseInt(l.sort(u)[l.length-1],10))/2,10),b=parseInt(h.top,10)+parseInt((parseInt(c.sort(u)[0],10)+parseInt(c.sort(u)[c.length-1],10))/2,10)}else b=parseInt(t.offset().top,10),f=parseInt(t.offset().left,10);var g=o?0:parseInt(t.outerWidth(),10),m=o?0:parseInt(t.outerHeight(),10),v=s.outerWidth(),S=s.outerHeight(),_=Math.round(f+Math.round((g-v)/2)),y=Math.round(b+m+i.offset+8),w=Math.round(v-16)/2-parseInt(s.css("borderLeftWidth"),10),x=0,B=f+g+v+i.offset+8>parseInt(e(window).width(),10),k=v+i.offset+8>f,A=S+i.offset+8>b-e(window).scrollTop(),T=b+m+S+i.offset+8>parseInt(e(window).height()+e(window).scrollTop(),10),C=i.anchor;k||"e"==i.anchor&&!B?"w"!=i.anchor&&"e"!=i.anchor||(C="e",x=Math.round(S/2-8-parseInt(s.css("borderRightWidth"),10)),w=-8-parseInt(s.css("borderRightWidth"),10),_=f+g+i.offset+8,y=Math.round(b+m/2-S/2)):(B||"w"==i.anchor&&!k)&&("w"!=i.anchor&&"e"!=i.anchor||(C="w",x=Math.round(S/2-8-parseInt(s.css("borderLeftWidth"),10)),w=v-parseInt(s.css("borderLeftWidth"),10),_=f-v-i.offset-8,y=Math.round(b+m/2-S/2))),T||"n"==i.anchor&&!A?"n"!=i.anchor&&"s"!=i.anchor||(C="n",x=S-parseInt(s.css("borderTopWidth"),10),y=b-(S+i.offset+8)):(A||"s"==i.anchor&&!T)&&("n"!=i.anchor&&"s"!=i.anchor||(C="s",x=-8-parseInt(s.css("borderBottomWidth"),10),y=b+m+i.offset+8)),"n"==i.anchor||"s"==i.anchor?v/2>f?(_=_<0?w+_:w,w=0):f+v/2>parseInt(e(window).width(),10)&&(_-=w,w*=2):A?(y+=x,x=0):T&&(y-=x,x*=2),delay&&clearTimeout(delay),delay=setTimeout(function(){s.css({"margin-left":_+"px","margin-top":y+"px"}).stop(!0,!0).fadeIn(i.fadeIn)},i.delay),s.attr("class","sb-tooltip "+C)},c=function(){(!i.aHide&&!o||i.aHide)&&(delay&&clearTimeout(delay),delay=setTimeout(function(){d()},i.delay))},d=function(){!i.aHide&&!o||i.aHide?(s.stop(!0,!0).fadeOut(i.fadeOut),i.hide&&i.hide.call(this)):setTimeout(function(){c()},200)}}})},e.fn.sbLanguageSwitcher=function(t=[],i="",s=!1){let a=`<div class="sb-language-switcher" data-source="${i}">`,n=[],r=e(this).hasClass("sb-language-switcher-cnt")?e(this):e(this).find(".sb-language-switcher-cnt");for(var l=0;l<t.length;l++)n.includes(t[l])||(a+=`<span ${s==t[l]?'class="sb-active" ':""}data-language="${t[l]}"><i class="sb-icon-close"></i><img src="${SB_URL}/media/flags/${t[l].toLowerCase()}.png" /></span>`,n.push(t[l]));return r.find(".sb-language-switcher").remove(),r.append(a+`<i data-sb-tooltip="${o("Add translation")}" class="sb-icon-plus"></i></div>`),r.sbInitTooltips(),this},e.fn.sbShowLightbox=function(t=!1,i=""){return S.find(".sb-lightbox").sbActive(!1),K.sbActive(!0),e(this).sbActive(!0),t?e(this).addClass("sb-popup-lightbox").attr("data-action",i):e(this).css({"margin-top":e(this).outerHeight()/-2+"px","margin-left":e(this).outerWidth()/-2+"px"}),e("body").addClass("sb-lightbox-active"),setTimeout(()=>{Fe.open_popup=this},500),this.preventDefault,this},e.fn.sbHideLightbox=function(){return e(this).find(".sb-lightbox,.sb-popup-lightbox").sbActive(!1).removeClass("sb-popup-lightbox").removeAttr("data-action"),K.sbActive(!1),e("body").removeClass("sb-lightbox-active"),Fe.open_popup=!1,this},e.fn.sbInitTooltips=function(){return e(this).find("[data-sb-tooltip]").each(function(){e(this).miniTip({content:e(this).attr("data-sb-tooltip"),anchor:"s",delay:500})}),this};var Be={dialogflow:{intents:!1,token:SBF.storage("dialogflow-token"),dialogflow_languages:[],smartReply:function(e=!1){let t=SBChat.conversation.id;SBF.ajax({function:"dialogflow-smart-reply",message:e,token:this.token,conversation_id:t,dialogflow_languages:this.dialogflow_languages},e=>{if(SBChat.conversation.id&&t===SBChat.conversation.id){let t=e.suggestions,s="",a=y.find(".sb-conversation .sb-list"),n=a[0].scrollTop===a[0].scrollHeight-a[0].offsetHeight,o=!(!SBChat.conversation||!SBChat.conversation.getLastMessage())&&SBChat.conversation.getLastMessage().message;e.token&&(this.token=e.token,SBF.storage("dialogflow-token",e.token));for(var i=0;i<t.length;i++)t[i]!=o&&(s+=`<span>${t[i]}</span>`);$.html(s),n&&SBChat.scrollBottom()}e.dialogflow_languages&&(this.dialogflow_languages=e.dialogflow_languages)})},showCreateIntentBox:function(e){let t="",i=SBChat.conversation.getMessage(e),s=i.message;if(SBF.isAgent(i.get("user_type")))t=SBChat.conversation.getLastUserMessage(i.get("index")),t=!(!t||!t.payload("sb-human-takeover"))&&SBChat.conversation.getLastUserMessage(t.get("index")),t=t?t.message:"";else{t=s;let e=SBChat.conversation.messages;for(var a=i.get("index");a<e.length;a++)if(["agent","admin"].includes(e[a].get("user_type"))){s=e[a].message;break}}!1===this.intents?SBF.ajax({function:"dialogflow-get-intents"},e=>{let i="";if(Array.isArray(e)){for(var s=0;s<e.length;s++)i+=`<option value="${e[s].name}">${e[s].displayName}</option>`;C.find("#sb-intents-select").append(i),this.intents=e}else this.intents=[];Be.openAI.generateIntents(t)}):Be.openAI.generateIntents(t),C.attr("data-message-id",i.id),C.find(".sb-type-text:not(.sb-first)").remove(),C.find(".sb-type-text input").val(t),C.find("textarea").val(s),C.find("#sb-intents-select").val(""),C.find(".sb-search-btn").sbActive(!1).find("input").val(""),this.searchIntents(""),C.sbShowLightbox()},submitIntent:function(i){if(n(i))return;let s=[],a=C.find("textarea").val(),o=C.find("#sb-intents-select").val();C.find(".sb-type-text input").each(function(){e(this).val()&&s.push(e(this).val())}),""==a&&!o||0==s.length?(SBForm.showErrorMessage(C,"Please insert the bot response and at least one user expression."),e(i).sbLoading(!1)):SBF.ajax({function:""==o?"dialogflow-create-intent":"dialogflow-update-intent",expressions:s,response:a,agent_language:C.find(".sb-dialogflow-languages select").val(),conversation_id:SBChat.conversation.id,intent_name:o},s=>{if(e(i).sbLoading(!1),!0===s)S.sbHideLightbox(),t(""==o?"Intent created":"Intent updated");else{let e="Error";"error"in s&&"message"in s.error&&(e=s.error.message),SBForm.showErrorMessage(C,e)}})},searchIntents:function(e){e=e.toLowerCase(),SBF.search(e,()=>{let t=!(e.length>1),i=t?`<option value="">${o("New Intent")}</option>`:"",s=this.intents;for(var a=0;a<s.length;a++){let o=t||s[a].displayName.toLowerCase().includes(e);if(!o&&"trainingPhrases"in s[a]){let t=s[a].trainingPhrases;for(var n=0;n<t.length;n++){for(var r=0;r<t[n].parts.length;r++)if(t[n].parts[r].text.toLowerCase().includes(e)){o=!0;break}if(o)break}}o&&(i+=`<option value="${s[a].name}">${s[a].displayName}</option>`)}C.find("#sb-intents-select").html(i).change()})},previewIntent:function(e){let t="";for(var i=0;i<this.intents.length;i++)if(this.intents[i].name==e){let e="trainingPhrases"in this.intents[i]?this.intents[i].trainingPhrases:[],o=e.length;if(o>1){for(var a=0;a<o;a++)for(var n=0;n<e[a].parts.length&&(t+=`<span>${e[a].parts[n].text}</span>`,15!=n);n++);s(t,"info",!1,"intent-preview-box","",o>10)}break}},translate:function(e,t,i){e.length&&SBF.ajax({function:"google-translate",strings:e,language_code:t,token:this.token},e=>{if(this.token=e[1],!Array.isArray(e[0]))return SBF.error(JSON.stringify(e[0]),"SBApps.dialogflow.translate"),!1;i(e[0])})}},openAI:{urls_history:[],progress:1,rewriteButton:function(e){F.length&&F.sbActive(e.length>2&&e.indexOf(" "))},rewrite:function(e,t=!1,i){SBF.ajax({function:"open-ai-message",model:SB_ADMIN_SETTINGS["open-ai-model"],message:`Make the following sentence more friendly and professional '${SB_LANGUAGE_CODES[SB_ADMIN_SETTINGS["active-agent-language"]]} language${t?", add greetings":""}: """'${e.replace('"',"'")}"""`},e=>{e[0]||console.error("OpenAI: "+JSON.stringify(e[1])),i(e)})},generateIntents:function(e){if(SB_ADMIN_SETTINGS["open-ai-user-expressions"]&&e){let t=C.find('[data-value="add"]');t.sbLoading(!0),C.find(".sb-open-ai-intent").remove(),SBF.ajax({function:"open-ai-user-expressions",message:e},e=>{let i="";for(var s=0;s<e.length;s++)i+=`<div class="sb-input-setting sb-type-text sb-open-ai-intent"><input type="text" value="${e[s]}"></div>`;i&&C.find("> div > .sb-type-text").last().after(i),t.sbLoading(!1)})}},crawler:{errors:[],base_url:!1,start_urls:[],sitemap_processed_urls:[],active_source:!1,start:function(i){if(i.length){let t=i[0],s=S.find("#sb-embeddings-box p");if(i.shift(),!t||!t.includes("http"))return;s.html(o("We are processing the source")+"<pre>"+t+"</pre><span>"+o("Only {R} sources left to complete.").replace("{R}",i.length+1)+"</span>"),t.includes(".xml")?(this.active_source=t,SBF.ajax({function:"get-sitemap-urls",sitemap_url:t},e=>Array.isArray(e)?(this.base_url=e[0],this.start(i.concat(e))):(console.error(e),this.start(i)))):t.includes(".pdf")||t.includes(".txt")?(this.active_source=t,SBF.ajax({function:"open-ai-source-file-to-paragraphs",url:t},e=>{if(!Array.isArray(e))return console.error(e),this.start(i);e.length&&this.embeddings(e,e=>{if(e)return this.start(i)})})):this.start_urls.includes(t)&&!this.sitemap_processed_urls.includes(t)?(this.active_source=t,this.sitemap_processed_urls.push(t),this.sitemap([t],e=>this.start(i.concat(e)))):this.getHTML(t,t=>{if(!t[0].length)return this.start(i);{let n=t[0],o=[];n.find("ul").each(function(){let t="";e(this).find("li").each(function(){e(this).find("ul").remove();let i=e(this).text().trim();i.split(" ").length>1&&i.length>10&&(t+="###B###"+(e(this).index()+1)+". "+e(this).text().trim())}),e(this).html(t)}),n.find("p").each(function(){e(this).append("###B###")}),n.find("span,label").each(function(){e(this).append(" ")}),n.find("a").each(function(){let t=e(this).attr("href");t&&e(this).html(t.includes("http")?t:m(t,Be.openAI.crawler.base_url))}),n.find("h1,h2,h3,h4,h5,h6").each(function(){e(this).prepend("###P###")});let r=n[0].textContent.split("###P###"),l=[];for(s=0;s<r.length;s++){let e=r[s].replace(/\s\s+/g," ");e.split(" ").length>5&&e.length>20&&l.push(e.replace(/###B###/g,"\n"))}r=[];for(var s=0;s<l.length;s++){let e=l[s].trim();for(;e.length<300&&l.length>s+1;)e+=([".",",",":","!","?",";","።","।","。","။"].includes(e.slice(-1))?"":".")+l[s+1].trim(),s++;if((e=e.replace(" .",".")).length>3500){let i=e.split("\n");e="";for(var a=0;a<i.length;a++)e.length+i[a].length<3500||a==i.length-1?e+=i[a]:(o.push([e,t[1]]),e="")}else o.push([e,t[1]])}this.embeddings(o,e=>{if(e)return this.start(i)})}})}else{this.errors.length?(setTimeout(()=>{s(o("There were {R} errors. Check the browser console for more details. Please try again.").replace("{R}",this.errors.length),"info")},300),console.error(this.errors)):(t("The chatbot has been successfully trained."),e("#open-ai-sources-file .repeater-item i").each(function(){ke.repeaterDelete(this)})),S.sbHideLightbox(),R.find("#open-ai-train-btn a").sbLoading(!1),this.sitemap_processed_urls=[];for(var a=0;a<this.start_urls.length;a++)SBF.ajax({function:"delete-file",path:this.start_urls[a]});ke.save()}},sitemap:function(t,i,s=[]){if(t.length){let a=t[0];t.shift(),s.push(a),this.base_url||(this.base_url=a),S.find("#sb-embeddings-box p").html(o("We are generating the sitemap")+"<pre>"+a+"</pre><span>"+o("Only {R} pages left to complete.").replace("{R}",t.length+1)+"</span>"),this.getHTML(a,n=>{let o=n[0].find("a");a=new URL(a),o.each((i,n)=>{let o=e(n).attr("href");o&&((o=m(o,this.base_url)).includes("#")&&(o=o.substring(0,o.indexOf("#"))),s.includes(o)||t.includes(o)||0!==o.indexOf(a.origin)||o.substring(o.lastIndexOf("/")).includes(".")&&!/.php|.html|.html|.asp|.aspx|.dhtml|.ece|.gne|.htmls|.php3|.rss|.rhtml/.test(o)||t.push(o))}),this.sitemap(t,i,s)})}else i(s)},getHTML:function(t,i){t=t.trim(),SBF.ajax({function:"get-html",url:t},function(t){let s="";if(e("body").find("#sb-html").remove(),200==t[1]){if(t=t[0],(s=t.substring(t.indexOf("<html"),t.indexOf(">",t.indexOf("<html")))).includes("lang=")){let e=t.indexOf("lang=")+6;s=t.substring(e,t.indexOf('"',e)).toLowerCase()}else s="";t=t.substring(t.indexOf("<body"),t.indexOf("</body")).replace("<br>","\n").replace("<br />","\n").replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/src=/g,"data-src=").replace(/<link /g,"<"),e("body").append('<div id="sb-html" style="display:none">'+t.replace(/\s\s+/g," ")+"</div>")}i([e("body").find("#sb-html"),s])})},embeddings:function(e,t){SBF.ajax({function:"open-ai-get-embeddings",paragraphs:JSON.stringify(e),save_source:this.active_source},e=>{this.errors=this.errors.concat(e[1]);this.errors.length;for(var i=0;i<e[0].length;i++)if(!e[0][i]){0;break}"chars-limit-exceeded"==e[1]?(s(o("The chatbot cannot be trained with these sources because the limit of your plan is {R} characters. Upgrade your plan to increase the number of characters.").replace("{R}",e[2]),"info"),t(!1)):t(!0)})}}},messenger:{check:function(e){return["fb","ig"].includes(e.get("source"))},send:function(e,t,i="",s=[],a,n=!1){SBF.ajax({function:"messenger-send-message",psid:e,facebook_page_id:t,message:i,attachments:s,metadata:a},e=>{n&&n(e),Be.unsupportedRichMessages(i,"Messenger")})}},whatsapp:{check:function(e){return"wa"==e.get("source")},send:function(e,t="",i=[],a=!1,n=!1){SBF.ajax({function:"whatsapp-send-message",to:e,message:t,attachments:i,phone_id:a},e=>{e.error&&s(e.error.message,"info",!1,"error-wa"),n&&n(e),Be.unsupportedRichMessages(t,"WhatsApp")})},activeUserPhone:function(e=i()){return!!e.getExtra("phone")&&e.getExtra("phone").value.replace("+","")}},telegram:{check:function(e){return"tg"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"telegram-send-message",chat_id:e,message:t,attachments:i},e=>{s&&s(e),Be.unsupportedRichMessages(t,"Telegram")})}},viber:{check:function(e){return"vb"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"viber-send-message",viber_id:e,message:t,attachments:i},e=>{s&&s(e),Be.unsupportedRichMessages(t,"Viber")})}},twitter:{check:function(e){return"tw"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"twitter-send-message",twitter_id:e,message:t,attachments:i},e=>{s&&s(e),Be.unsupportedRichMessages(t,"Twitter")})}},gbm:{token:!1,check:function(e){return"bm"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"gbm-send-message",google_conversation_id:e,message:t,attachments:i,token:this.token},e=>{s&&s(e),this.token=e[2],Be.unsupportedRichMessages(t,"Google Business Messages")})}},line:{check:function(e){return"ln"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"line-send-message",line_id:e,message:t,attachments:i},e=>{s&&s(e),Be.unsupportedRichMessages(t,"LINE")})}},wechat:{token:!1,check:function(e){return"wc"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"wechat-send-message",open_id:e,message:t,attachments:i,token:this.token},e=>{Array.isArray(e)&&(this.token=e[1],e=e[0]),s&&s(e),Be.unsupportedRichMessages(t,"WeChat")})}},aecommerce:{panel:!1,conversationPanel:function(){let t="",s=i().getExtra("aecommerce-id");this.panel||(this.panel=y.find(".sb-panel-aecommerce")),s&&!n(this.panel)&&SBF.ajax({function:"aecommerce-get-conversation-details",aecommerce_id:s.value},i=>{t=`<h3>${SB_ADMIN_SETTINGS["aecommerce-panel-title"]}</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div><div class="sb-title">${o("Cart")}</div><div class="sb-list-items sb-list-links sb-aecommerce-cart">`;for(s=0;s<i.cart.length;s++){let e=i.cart[s];t+=`<a href="${e.url}" target="_blank" data-id="${e.id}"><span>#${e.id}</span> <span>${e.name}</span> <span>x ${e.quantity}</span></a>`}if(t+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){t+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-list-links sb-aecommerce-orders">`;for(var s=0;s<i.orders.length;s++){let e=i.orders[s],a=e.id;t+=`<a data-id="${a}" href="${e.url}" target="_blank"><span>#${e.id}</span> <span>${SBF.beautifyTime(e.time,!0)}</span> <span>${i.currency_symbol}${e.price}</span></a>`}t+="</div>"}e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html(t)}},martfury:{panel:!1,conversationPanel:function(){let t=i().getExtra("martfury-id");this.panel||(this.panel=y.find(".sb-panel-martfury")),t&&!n(this.panel)&&SBF.ajax({function:"martfury-get-conversation-details",martfury_id:t.value},t=>{e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html("")}},whmcs:{panel:!1,conversationPanel:function(){let t="",s=i().getExtra("whmcs-id");this.panel||(this.panel=y.find(".sb-panel-whmcs")),s&&!n(this.panel)&&SBF.ajax({function:"whmcs-get-conversation-details",whmcs_id:s.value},i=>{let s=["products","addons","domains"];t=`<h3>WHMCS</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of services")}</div><span>${i.services_count} ${o("services")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div>`,t+="</div>";for(var a=0;a<s.length;a++){let e=i[s[a]];if(e.length){t+=`<div class="sb-title">${o(SBF.slugToString(s[a]))}</div><div class="sb-list-items">`;for(var n=0;n<e.length;n++)t+=`<div>${e[n].name}</div>`;t+="</div>"}}t+=`<a href="${SB_ADMIN_SETTINGS["whmcs-url"]}/clientssummary.php?userid=${i["client-id"]}" target="_blank" class="sb-btn sb-whmcs-link">${o("View on WHMCS")}</a>`,e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html(t)}},perfex:{conversationPanel:function(){let e=i().getExtra("perfex-id");y.find(".sb-panel-perfex").html(""==e?"":`<a href="${SB_ADMIN_SETTINGS["perfex-url"]}/admin/clients/client/${e.value}" target="_blank" class="sb-btn sb-perfex-link">${o("View on Perfex")}</a>`)}},ump:{panel:!1,conversationPanel:function(){if(n(this.panel))return;this.panel||(this.panel=y.find(".sb-panel-ump"));let t,i="";SBF.ajax({function:"ump-get-conversation-details"},s=>{if((t=s.subscriptions).length){i='<i class="sb-icon-refresh"></i><h3>Membership</h3><div class="sb-list-names">';for(var a=0;a<t.length;a++){let e=t[a].expired;i+=`<div${e?' class="sb-expired"':""}><span>${t[a].label}</span><span>${o(e?"Expired on":"Expires on")} ${SBF.beautifyTime(t[a].expire_time,!1,!e)}</span></div>`}i+=`</div><span class="sb-title">${o("Total spend")} ${s.currency_symbol}${s.total}</span>`}e(this.panel).html(i).sbLoading(!1),l(this.panel,160)})}},armember:{panel:!1,conversationPanel:function(){let t=i().getExtra("wp-id");if(this.panel||(this.panel=y.find(".sb-panel-armember")),SBF.null(t)||n(this.panel))e(this.panel).html("");else{let s,a="";t=t.value,SBF.ajax({function:"armember-get-conversation-details",wp_user_id:t},t=>{if((s=t.subscriptions).length){a=`<i class="sb-icon-refresh"></i><h3>${o("Plans")}</h3><div class="sb-list-names">`;for(var n=0;n<s.length;n++){let e=s[n].expired;a+=`<div${e?' class="sb-expired"':""}><span>${s[n].arm_current_plan_detail.arm_subscription_plan_name}</span><span>${"never"==s[n].expire_time?"":o(e?"Expired on":"Expires on")+" "+SBF.beautifyTime(s[n].expire_time,!1,!e)}</span></div>`}a+=`</div><span class="sb-title">${o("Total spend")} ${t.currency_symbol}${t.total}<a href="${window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"?page=arm_manage_members&member_id="+i().getExtra("wp-id").value}" target="_blank" class="sb-btn-text"><i class="sb-icon-user"></i> ${o("View member")}</a></span>`}e(this.panel).html(a).sbLoading(!1),l(this.panel,160)})}}},zendesk:{conversationPanel:function(){if(!SB_ADMIN_SETTINGS["zendesk-active"])return;let t=i().getExtra("zendesk-id"),s=i().getExtra("phone"),a=i().get("email"),o=y.find(".sb-panel-zendesk");(t||s||a)&&!n(o)?SBF.ajax({function:"zendesk-get-conversation-details",conversation_id:SBChat.conversation.id,zendesk_id:!!t&&t.value,phone:!!s&&s.value,email:a},t=>{e(o).html(t).sbLoading(!1),o.find(".sb-zendesk-date").each(function(){e(this).html(SBF.beautifyTime(e(this).html()))}),l(o,160)}):e(o).html("")}},woocommerce:{popupPaginationNumber:1,popupLanguage:"",popupCache:[],panel:!1,timeout:!1,popupCode:function(e,t=!0){let i="";for(var s=0;s<e.length;s++)i+=`<li data-id="${e[s].id}"><div class="sb-image" style="background-image:url('${e[s].image}')"></div><div><span>${e[s].name}</span><span>${SB_ADMIN_SETTINGS.currency}${e[s].price}</span></div></li>`;return t&&""==i?`<p>${o("No products found")}</p>`:i},popupSearch:function(t){c(t,(t,i)=>{""==t?this.popupPopulate(function(){e(i).sbLoading(!1)}):(this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-search-products",search:t},t=>{ae.html(this.popupCode(t)),e(i).sbLoading(!1)}))})},popupFilter:function(t){n(ae)||(ae.html(""),this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-get-products",user_language:this.popupLanguage,filters:{taxonomy:e(t).data("value")}},e=>{ae.html(this.popupCode(e)).sbLoading(!1)}))},popupPopulate:function(e=!1){this.popupLanguage=0!=i()&&SB_ADMIN_SETTINGS.languages.includes(i().language)?i().language:"",this.popupPaginationNumber=1,ae.html("").sbLoading(!0),SBF.ajax({function:"woocommerce-products-popup",user_language:this.popupLanguage},t=>{let i="",s=se.find(".sb-select");for(var a=0;a<t[1].length;a++)i+=`<li data-value="${t[1][a].id}">${t[1][a].name}</li>`;s.find("> p").html(o("All")),s.find("ul").html(`<li data-value="" class="sb-active">${o("All")}</li>`+i),ae.html(this.popupCode(t[0])).sbLoading(!1),!1!==e&&e()})},popupPagination:function(t){this.popupPaginationNumber&&(ae.sbLoading(t),SBF.ajax({function:"woocommerce-get-products",filters:{taxonomy:e(t).parent().find(".sb-select p").attr("data-value")},pagination:this.popupPaginationNumber,user_language:this.popupLanguage},e=>{ae.append(this.popupCode(e,!1)).sbLoading(!1),this.popupPaginationNumber++,d(t,!1,300),e.length||(this.popupPaginationNumber=0)}))},conversationPanel:function(){if(n(this.panel))return;this.panel||(this.panel=y.find(".sb-panel-woocommerce"));let t="";SBF.ajax({function:"woocommerce-get-conversation-details"},i=>{t=`<i class="sb-icon-refresh"></i><h3>WooCommerce</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div><div class="sb-title">${o("Cart")}<i class="sb-add-cart-btn sb-icon-plus"></i></div><div class="sb-list-items sb-list-links sb-woocommerce-cart">`;for(s=0;s<i.cart.length;s++){let e=i.cart[s];t+=`<a href="${e.url}" target="_blank" data-id="${e.id}"><span>#${e.id}</span> <span>${e.name}</span> <span>x ${e.quantity}</span><i class="sb-icon-close"></i></a>`}if(t+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){t+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-woocommerce-orders sb-accordion">`;for(var s=0;s<i.orders.length;s++){let e=i.orders[s],a=e.id;t+=`<div data-id="${a}"><span><span>#${a}</span> <span>${SBF.beautifyTime(e.date,!0)}</span><a href="${Q}/wp-admin/post.php?post=${a}&action=edit" target="_blank" class="sb-icon-next"></a></span><div></div></div>`}t+="</div>"}e(this.panel).html(t).sbLoading(!1),l(this.panel,160)})},conversationPanelOrder:function(e){let t=this.panel.find(`[data-id="${e}"] > div`);t.html(""),SBF.ajax({function:"woocommerce-get-order",order_id:e},e=>{let i="",s=this.panel.find(".sb-collapse-btn:not(.sb-active)");if(e){let t=e.products;i+=`<div class="sb-title">${o("Order total")}: <span>${e.currency_symbol}${e.total}<span></div><div class="sb-title">${o("Order status")}: <span>${SBF.slugToString(e.status.replace("wc-",""))}<span></div><div class="sb-title">${o("Date")}: <span>${SBF.beautifyTime(e.date,!0)}<span></div><div class="sb-title">${o("Products")}</div>`;for(a=0;a<t.length;a++)i+=`<a href="${Q}?p=${t[a].id}" target="_blank"><span>#${t[a].id}</span> <span>${t[a].quantity} x</span> <span>${t[a].name}</span></a>`;for(var a=0;a<2;a++){let t=0==a?"shipping":"billing";e[t+"_address"]&&(i+=`<div class="sb-title">${o((0==a?"Shipping":"Billing")+" address")}</div><div class="sb-multiline">${e[t+"_address"].replace(/\\n/g,"<br>")}</div>`)}}s.length&&s.click(),t.html(i)})},conversationPanelUpdate:function(e,t="added"){let i=!1,s=0;this.timeout=setInterval(()=>{i||(SBF.ajax({function:"woocommerce-get-conversation-details"},a=>{let n=!0;for(var o=0;o<a.cart.length;o++)a.cart[o].id==e&&("added"==t?s=61:n=!1);(s>60||n)&&(this.conversationPanel(),y.find(".sb-add-cart-btn,.sb-woocommerce-cart > a i").sbLoading(!1),clearInterval(this.timeout)),s++,i=!1}),i=!0)},1e3)}},wordpress:{ajax:function(t,i,s){e.ajax({method:"POST",url:SB_WP_AJAX_URL,data:e.extend({action:"sb_wp_ajax",type:t},i)}).done(e=>{!1!==s&&s(e)})}},is:function(e){if(typeof SB_VERSIONS==me)return!1;switch(e){case"gbm":case"zendesk":case"twitter":case"wechat":case"line":case"viber":case"telegram":case"armember":case"aecommerce":case"martfury":case"whmcs":case"perfex":case"ump":case"messenger":case"whatsapp":case"woocommerce":case"dialogflow":case"slack":case"tickets":return typeof SB_VERSIONS[e]!=me&&-1!=SB_VERSIONS[e];case"wordpress":return typeof SB_WP!=me;case"sb":return!0}return!1},unsupportedRichMessages:function(e,i,s=[]){s.push("timetable","registration","table","inputs"),"Messenger"!=i&&s.push("email");for(var a=0;a<s.length;a++)e.includes("["+s[a])&&t("The Support Board {R} rich message is not supported by {R2}. The rich message was not sent to {R2}.".replace(/{R}/g,SBF.slugToString(s[a])).replace(/{R2}/g,i),"error")}},ke={init:!1,save:function(i=!1){if(i&&n(i))return;let s={},a={};switch(R.find(" > .sb-tab > .sb-nav .sb-active").attr("id")){case"tab-articles":this.articles.save(s=>{t(!0===s?"Articles and categories saved":s),i&&e(i).sbLoading(!1)});break;case"tab-automations":let n=O.find(".sb-active").attr("data-id");ke.automations.save(s=>{t(!0===s?"Automations saved":s),ke.automations.populate(),O.find(`[data-id="${n}"]`).click(),i&&e(i).sbLoading(!1)});break;case"tab-translations":this.translations.updateActive(),SBF.ajax({function:"save-translations",translations:JSON.stringify(this.translations.to_update)},()=>{t("Translations saved"),i&&e(i).sbLoading(!1)});break;default:R.find(".sb-setting").each((t,i)=>{let n=this.get(i),o=e(i).data("setting");if(n[0])if(typeof o!=me){let t=!1;if(e(i).find("[data-language]").length){let s=e(i).find("[data-language].sb-active");if(t=n[0]in this.translations.originals&&this.translations.originals[n[0]],this.translations.save(i,!!s.length&&s.attr("data-language")),t&&"string"!=typeof t)for(var r in t)t[r]=[t[r],n[1][r][1]]}o in s||(s[o]={}),s[o][n[0]]=[t||n[1],n[2]]}else a[n[0]]=[n[1],n[2]]}),SBF.ajax({function:"save-settings",settings:JSON.stringify(a),external_settings:s,external_settings_translations:this.translations.translations},()=>{i&&(t("Settings saved"),e(i).sbLoading(!1))})}},initPlugins:function(){R.find("textarea").each(function(){e(this).autoExpandTextarea(),e(this).manualExpandTextarea()}),R.find("[data-setting] .sb-language-switcher-cnt").each(function(){e(this).sbLanguageSwitcher(ke.translations.getLanguageCodes(e(this).closest("[data-setting]").attr("id")),"settings")})},initColorPicker:function(t=!1){e(t||R).find(".sb-type-color input").colorPicker({renderCallback:function(t,i){e(t.context).closest(".input").find("input").css("background-color",t.text)}})},initHTML:function(e){if("slack-agents"in e){let i="";for(var t in e["slack-agents"][0])i+=`<div data-id="${t}"><select><option value="${e["slack-agents"][0][t]}"></option></select></div>`;R.find("#slack-agents .input").html(i)}},get:function(t){let i=(t=e(t)).attr("id"),s=t.data("type");switch(s){case"upload":case"range":case"number":case"text":case"password":case"color":case"upload-file":return[i,t.find("input").val(),s];case"textarea":return[i,t.find("textarea").val(),s];case"select":return[i,t.find("select").val(),s];case"checkbox":return[i,t.find("input").is(":checked"),s];case"radio":let a=t.find("input:checked").val();return SBF.null(a)&&(a=""),[i,a,s];case"upload-image":let n=t.find(".image").attr("data-value");return SBF.null(n)&&(n=""),[i,n,s];case"multi-input":let o={};return t.find(".input > div").each((e,t)=>{let i=this.get(t);i[0]&&(o[i[0]]=[i[1],i[2]])}),[i,o,s];case"select-images":return[i,t.find(".input > .sb-active").data("value"),s];case"repeater":return[i,this.repeater("get",t.find(".repeater-item"),""),s];case"double-select":let r={};return t.find(".input > div").each(function(){let t=e(this).find("select").val();-1!=t&&(r[e(this).attr("data-id")]=[t])}),[i,r,s];case"select-checkbox":return[i,t.find(".sb-select-checkbox input:checked").map(function(){return e(this).attr("id")}).get(),s];case"timetable":let l={};return t.find(".sb-timetable > [data-day]").each(function(){let t=e(this).attr("data-day"),i=[];e(this).find("> div > div").each(function(){let t=e(this).html(),s=e(this).attr("data-value");SBF.null(s)?i.push(["",""]):"closed"==s?i.push(["closed","Closed"]):i.push([s,t])}),l[t]=i}),[i,l,s];case"color-palette":return[i,t.attr("data-value"),s]}return["","",""]},set:function(t,i){let s=e(i)[1],a=e(i)[0];switch(t=`#${t}`,s){case"color":case"upload":case"number":case"text":case"password":case"upload-file":R.find(`${t} input`).val(a);break;case"textarea":R.find(`${t} textarea`).val(a);break;case"select":R.find(`${t} select`).val(a);break;case"checkbox":R.find(`${t} input`).prop("checked","false"!=a&&a);break;case"radio":R.find(`${t} input[value="${a}"]`).prop("checked",!0);break;case"upload-image":a&&R.find(t+" .image").attr("data-value",a).css("background-image",`url("${a}")`);break;case"multi-input":for(var n in a)this.set(n,a[n]);break;case"range":let i=a;R.find(t+" input").val(i),R.find(t+" .range-value").html(i);break;case"select-images":R.find(t+" .input > div").sbActive(!1),R.find(t+` .input > [data-value="${a}"]`).sbActive(!0);break;case"select-checkbox":for(o=0;o<a.length;o++)R.find(`input[id="${a[o]}"]`).prop("checked",!0);R.find(t+" .sb-select-checkbox-input").val(a.join(", "));break;case"repeater":let r=this.repeater("set",a,R.find(t+" .repeater-item:last-child"));r&&R.find(t+" .sb-repeater").html(r);break;case"double-select":for(var n in a)R.find(`${t} .input > [data-id="${n}"] select`).val(a[n]);break;case"timetable":for(var n in a){let i=R.find(`${t} [data-day="${n}"] > div > div`);for(var o=0;o<i.length;o++)e(i[o]).attr("data-value",a[n][o][0]).html(a[n][o][1])}break;case"color-palette":a&&R.find(t).attr("data-value",a)}},repeater:function(t,i,s){if(s=e(s).html(),"set"==t){var a="";if(i.length>0){e(s).find(".sb-icon-close").remove();for(var n=0;n<i.length;n++){let t=e(e.parseHTML(`<div>${s}</div>`));for(var o in i[n])this.setInput(t.find(`[data-id="${o}"]`),i[n][o]);a+=`<div class="repeater-item">${t.html()}<i class="sb-icon-close"></i></div>`}}return a}if("get"==t){let t=[],s=this;return e(i).each(function(){let i={},a=!0;e(this).find("[data-id]").each(function(){let t=s.getInput(this);a&&t&&"hidden"!=e(this).attr("type")&&"auto-id"!=e(this).attr("data-type")&&(a=!1),i[e(this).attr("data-id")]=t}),a||t.push(i)}),t}},repeaterAdd:function(t){let i=e(t).parent();(t=e(e.parseHTML(`<div>${i.find(".repeater-item:last-child").html()}</div>`))).find("[data-id]").each(function(){if(ke.resetInput(this),"auto-id"==e(this).data("type")){let t=1;i.find('[data-type="auto-id"]').each(function(){let i=parseInt(e(this).val());i>t&&(t=i)}),e(this).attr("value",t+1)}}),i.find(".sb-repeater").append(`<div class="repeater-item">${t.html()}</div>`)},repeaterDelete:function(t){let i=e(t).parent();i.parent().find(".repeater-item").length>1?i.remove():i.find("[data-id]").each((e,t)=>{this.resetInput(t)})},setInput:function(t,i){if(i=e.trim(i),(t=e(t)).is("select"))t.find(`option[value="${i}"]`).attr("selected","");else if(t.is(":checkbox")&&i&&"false"!=i)t.attr("checked","");else if(t.is("textarea"))t.html(i);else{let e=t.is("div");e||t.is("i")||t.is("li")?(t.attr("data-value",i),e&&t.hasClass("image")&&t.css("background-image",i?`url("${i}")`:"")):t.attr("value",i)}},getInput:function(t){if((t=e(t)).is(":checkbox"))return t.is(":checked");if(t.is("div")||t.is("i")||t.is("li")){let e=t.attr("data-value");return SBF.null(e)?"":e}return t.val()},resetInput:function(t){(t=e(t)).is("select")?t.val("").find("[selected]").removeAttr("selected"):t.is("checkbox")&&value?t.removeAttr("checked").prop("checked",!1):t.is("textarea")?t.html(""):t.removeAttr("value").removeAttr("style").removeAttr("data-value").val("")},getSettingObject:function(t){return e(t)[0].hasAttribute("data-setting")?e(t):e(t).closest("[data-setting]")},articles:{categories:[],articles:[],translations:{},get:function(e,t=!1,i=!0){SBF.ajax({function:"get-articles",categories:t,articles_language:"all",full:i},t=>{e(t)})},save:function(t=!1){if(this.updateActiveArticle(),ye)if(we)we=!1;else if(this.activeID()&&-1!=this.activeID())return void(we=t);D.find(".sb-new-category-cnt input").each((t,i)=>{let s=e.trim(e(i).val());s&&this.categories.push({id:SBF.random(),title:s}),e(i).parents().eq(1).remove()}),this.categories.length&&this.categories.sort(function(e,t){return e.title&&t.title?e.title.localeCompare(t.title):1}),SBF.ajax({function:"save-articles",articles:JSON.stringify(this.articles),translations:this.translations,categories:this.categories.length?this.categories:"delete_all"},e=>{D.find(".sb-menu-wide .sb-active").click(),D.find(`.sb-nav [data-id="${this.activeID()}"]`).click(),this.updateSelect(),t&&t(e)}),Be.is("dialogflow")&&SBF.ajax({function:"dialogflow-knowledge",articles:this.articles})},show:function(t=!1,i=!1,s=!1){let a=[-1,"","","",""];this.updateActiveArticle(),this.hide(!1);let n=s?s in this.translations?this.translations[s]:[]:this.articles;!1===t&&(t=this.activeID());for(o=0;o<n.length;o++)if(n[o].id==t){a=[t,n[o].title,n[o].content,n[o].link,SBF.null(n[o].categories)?[""]:n[o].categories,SBF.null(n[o].parent_category)?"":n[o].parent_category,n[o].editor_js],i&&(e(i).siblings().sbActive(!1),e(i).sbActive(!0));break}j.val(""),U.val(a[5]);for(var o=0;o<a[4].length;o++)j.eq(o).val(a[4][o]);D.sbLanguageSwitcher(this.getTranslations(t),"articles",s),D.find(".sb-content").attr("data-id",a[0]),D.find(".sb-article-title input").val(a[1]),D.find(".sb-article-link input").val(a[3]),D.find("#sb-article-id").html(`ID <span>${a[0]}</span>`),ye||D.find("#editorjs").length?f(a[6]?a[6]:a[2]):D.find(".sb-article-content textarea").val(a[2])},add:function(){let e=D.find(".sb-nav > ul"),t=SBF.random();this.updateActiveArticle(),this.articles.push({id:t,title:"",content:"",link:"",categories:[]}),this.hide(!1),e.find(".sb-active").sbActive(!1),e.find(".sb-no-results").remove(),e.append(`<li class="sb-active" data-id="${t}">${o("Article")} ${e.find("li").length+1}<i class="sb-icon-delete"></i></li>`),D.find("input, textarea, select").val(""),D.find(".sb-content").attr("data-id",t),D.sbLanguageSwitcher([],"articles"),f()},addCategory:function(){D.find('[data-type="categories"] .sb-no-results').remove(),D.find(".sb-new-category-cnt").append('<div class="sb-input-setting sb-type-text"><div><input type="text"></div></div>')},delete:function(t,i=!1){let s=e(t).closest(".sb-nav").find(" > ul"),a=e(t).parent(),n=a.attr("data-id");this[i?"categories":"articles"].splice(a.index(),1),this.hide(),s.find("li").length>1?e(t).parent().remove():s.html(`<li class="sb-no-results">${o("No results found.")}</li>`);for(var r in this.translations)for(var l=0;l<this.translations[r].length;l++)this.translations[r][l].id===n&&this.translations[r].splice(l,1);g()},populate:function(e=!1,t=!1){if(!1===e&&(e=t?this.categories:this.articles),Array.isArray(e)){let s="";if(t?this.categories=e:this.articles=e,e.length)for(var i=0;i<e.length;i++)s+=`<li data-id="${e[i].id}">${t?"<span>"+e[i].id+"</span>":""}${e[i].title}<i class="sb-icon-delete${t?" sb-category":""}"></i></li>`;else s=`<li class="sb-no-results">${o("No results found.")}</li>`;D.find(".sb-add-category,.sb-new-category-cnt").sbActive(t),D.find(".sb-add-article").sbActive(!t),D.find(".sb-nav").attr("data-type",t?"categories":"articles"),D.find(".sb-nav > ul").html(s),this.hide()}else SBF.error(e,"SBSettings.articles.populate")},updateActiveArticle:function(){let t=this.activeID();if(t&&-1!=t){let s,a=D.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),n=a?a in this.translations?this.translations[a]:[]:this.articles,o=[];j.each(function(){e(this).val()&&o.push(e(this).val())});for(var i=0;i<n.length;i++)if(n[i].id==t){s={id:t,title:D.find(".sb-article-title input").val(),content:D.find(".sb-article-content textarea").val(),link:D.find(".sb-article-link input").val(),categories:o,parent_category:U.val()},ye&&typeof ye.save!==me?ye.save().then(e=>{s.editor_js=e,s.content=b(e.blocks),n[i]=s,we&&this.save(we)}).catch(e=>{console.log(e)}):n[i]=s,SBF.null(s.title)&&this.delete(D.find(`.sb-nav [data-id="${t}"] i`));break}}},updateSelect:function(){let t=[],i=U.val(),s='<option value=""></option>';j.each(function(){t.push(e(this).val())});for(a=0;a<this.categories.length;a++)s+=`<option value="${this.categories[a].id}">${this.categories[a].title}</option>`;j.html(s),U.html(s),U.val(i);for(var a=0;a<t.length;a++)j.eq(a).val(t[a])},addTranslation:function(e=!1,t){if(!1===e&&(e=this.activeID()),this.getTranslations(e).includes(e))return console.warn("Article translation already in array.");t in this.translations||(this.translations[t]=[]),this.translations[t].push({id:e,title:"",content:"",link:"",categories:[]})},getTranslations:function(e=!1){let t=[];!1===e&&(e=this.activeID());for(var i in this.translations){let a=this.translations[i];for(var s=0;s<a.length;s++)if(a[s].id==e){t.push(i);break}}return t},deleteTranslation:function(e=!1,t){if(!1===e&&(e=this.activeID()),t in this.translations){let s=this.translations[t];for(var i=0;i<s.length;i++)if(s[i].id==e)return this.translations[t].splice(i,1),!0}return!1},activeID:function(){return D.find(".sb-content").attr("data-id")},hide:function(e=!0){D.find(".sb-content").setClass("sb-hide",e)}},automations:{items:{messages:[],emails:[],sms:[],popups:[],design:[],more:[]},translations:{},conditions:{datetime:["Date time",["Is between","Is exactly"],"dd/mm/yyy hh:mm - dd/mm/yyy hh:mm"],repeat:["Repeat",["Every day","Every week","Every month","Every year"]],browsing_time:["Browsing time",[],"seconds"],scroll_position:["Scroll position",[],"px"],include_urls:["Include URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],exclude_urls:["Exclude URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],referring:["Referring URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],user_type:["User type",["Is visitor","Is lead","Is user","Is not visitor","Is not lead","Is not user"]],returning_visitor:["Returning visitor",["First time visitor","Returning visitor"]],countries:["Countries",[],"Country codes separated by commas"],languages:["Languages",[],"Language codes separated by commas"],cities:["Cities",[],"Cities separated by commas"],custom_variable:["Custom variable",[],"variable=value"]},get:function(e){SBF.ajax({function:"automations-get"},t=>{this.items=t[0],this.translations=Array.isArray(t[1])&&!t[1].length?{}:t[1],e(t)})},save:function(e=!1){this.updateActiveItem(),SBF.ajax({function:"automations-save",automations:this.items,translations:this.translations},t=>{e&&e(t)})},show:function(e=!1,t=!1){this.updateActiveItem();let i=t?t in this.translations?this.translations[t]:[]:this.items,s=G.find(" > .sb-tab > .sb-content");!1===e&&(e=this.activeID()),this.hide(!1);for(var a in i)for(var n=0;n<i[a].length;n++){let o=i[a][n],r=o.conditions;if(o.id==e){H.html("");for(var a in o){let e=s.find(`[data-id="${a}"]`);e.hasClass("image")?(e.css("background-image",`url(${o[a]})`).attr("data-value",o[a]),""==o[a]&&e.removeAttr("data-value")):"checkbox"==e.attr("type")?e.prop("checked",o[a]):e.val(o[a])}if(r)for(var a in r){this.addCondition();let e=H.find(" > div:last-child");e.find("select").val(r[a][0]),this.updateCondition(e.find("select")),e.find(" > div").eq(1).find("select,input").val(r[a][1]),r[a].length>2&&e.find(" > div").eq(2).find("input").val(r[a][2])}return H.parent().setClass("sb-hide",t),s.sbLanguageSwitcher(this.getTranslations(e),"automations",t),!0}}return!1},add:function(){let e=SBF.random(),t=`${o("Item")} ${O.find("li:not(.sb-no-results)").length+1}`;this.updateActiveItem(),this.items[this.activeType()].push(this.itemArray(this.activeType(),e,t)),this.hide(!1),O.find(".sb-active").sbActive(!1),O.find(".sb-no-results").remove(),O.append(`<li class="sb-active" data-id="${e}">${t}<i class="sb-icon-delete"></i></li>`),G.find(".sb-automation-values").find("input, textarea").val(""),G.sbLanguageSwitcher([],"automations"),H.html("")},delete:function(t){this.items[this.activeType()].splice(e(t).parent().index(),1),e(t).parent().remove(),this.hide(),0==this.items[this.activeType()].length&&O.html(`<li class="sb-no-results">${o("No results found.")}</li>`)},populate:function(e=!1){!1===e&&(e=this.activeType());let t="",i=this.items[e];if(this.updateActiveItem(),i.length)for(s=0;s<i.length;s++)t+=`<li data-id="${i[s].id}">${i[s].name}<i class="sb-icon-delete"></i></li>`;else t=`<li class="sb-no-results">${o("No results found.")}</li>`;switch(O.html(t),t="",e){case"emails":t=`<h2>${o("Subject")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="subject" type="text"></div></div>`;break;case"popups":t=`<h2>${o("Title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div><h2>${o("Profile image")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="profile_image" class="image"><i class="sb-icon-close"></i></div></div></div><h2>${o("Message fallback")}</h2><div class="sb-input-setting sb-type-checkbox"><div><input data-id="fallback" type="checkbox"></div></div>`;break;case"design":t=`<h2>${o("Header title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div>`;for(s=1;s<4;s++)t+=`<h2>${o((1==s?"Primary":2==s?"Secondary":"Tertiary")+" color")}</h2><div data-type="color" class="sb-input-setting sb-type-color"><div class="input"><input data-id="color_${s}" type="text"><i class="sb-close sb-icon-close"></i></div></div>`;for(var s=1;s<4;s++)t+=`<h2>${o(1==s?"Header background image":2==s?"Header brand image":"Chat button icon")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="${1==s?"background":2==s?"brand":"icon"}" class="image"><i class="sb-icon-close"></i></div></div></div>`;break;case"more":t=`<h2>${o("Department ID")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="department" type="number"></div></div><h2>${o("Agent ID")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="agent" type="number"></div></div><h2>${o("Article IDs")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="articles" type="text"></div></div><h2>${o("Articles category")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="articles_category" type="text"></div></div>`}G.find(".sb-automation-extra").html(t),G.attr("data-automation-type",e),ke.initColorPicker(G),this.hide()},updateActiveItem:function(){let t=this.activeID();if(t){let s=G.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),a=this.activeType(),n=s?s in this.translations?this.translations[s][a]:[]:this.items[a],o=H.find(" > div");for(var i=0;i<n.length;i++)if(n[i].id==t){n[i]={id:t,conditions:[]},G.find(".sb-automation-values").find('input,textarea,[data-type="upload-image"] .image').each(function(){n[i][e(this).attr("data-id")]=e(this).hasClass("image")&&e(this)[0].hasAttribute("data-value")?e(this).attr("data-value"):"checkbox"==e(this).attr("type")?e(this).is(":checked"):e(this).val()}),o.each(function(){let t=[];e(this).find("input,select").each(function(){t.push(e(this).val())}),t[0]&&t[1]&&(2==t.length||t[2])&&n[i].conditions.push(t)}),SBF.null(n[i].name)&&this.delete(O.find(`[data-id="${t}"] i`));break}}},addCondition:function(){H.append(`<div><div class="sb-input-setting sb-type-select sb-condition-1"><select>${this.getAvailableConditions()}</select></div></div>`)},updateCondition:function(t){e(t).parent().siblings().remove();let i=e(t).parents().eq(1);if(e(t).val()){let a=this.conditions[e(t).val()],n="";if(a[1].length){n='<div class="sb-input-setting sb-type-select sb-condition-2"><select>';for(var s=0;s<a[1].length;s++)n+=`<option value="${SBF.stringToSlug(a[1][s])}">${o(a[1][s])}</option>`;n+="</select></div>"}i.append(n+(a.length>2?`<div class="sb-input-setting sb-type-text"><input placeholder="${o(a[2])}" type="text"></div>`:"")),i.siblings().find(".sb-condition-1 select").each(function(){let t=e(this).val();e(this).html(ke.automations.getAvailableConditions(t)),e(this).val(t)})}else i.remove()},getAvailableConditions:function(t=""){let i='<option value=""></option>',s=[];H.find(".sb-condition-1 select").each(function(){s.push(e(this).val())});for(var a in this.conditions)s.includes(a)&&a!=t||(i+=`<option value="${a}">${o(this.conditions[a][0])}</option>`);return i},addTranslation:function(e=!1,t=!1,i){if(!1===e&&(e=this.activeID()),!1===t&&(t=this.activeType()),this.getTranslations(e).includes(e))return console.warn("Automation translation already in array.");i in this.translations||(this.translations[i]={messages:[],emails:[],sms:[],popups:[],design:[]}),t in this.translations[i]||(this.translations[i][t]=[]),this.translations[i][t].push(this.itemArray(t,e))},getTranslations:function(e=!1){let t=[];!1===e&&(e=this.activeID());for(var i in this.translations){let n=this.translations[i];for(var s in n){let o=n[s];for(var a=0;a<o.length;a++)if(o[a].id==e){t.push(i);break}}}return t},deleteTranslation:function(e=!1,t){if(!1===e&&(e=this.activeID()),t in this.translations){let a=this.translations[t];for(var i in a){let n=a[i];for(var s=0;s<n.length;s++)if(n[s].id==e)return this.translations[t][i].splice(s,1),!0}}return!1},activeID:function(){let e=O.find(".sb-active");return!!e.length&&e.attr("data-id")},activeType:function(){return P.find("li.sb-active").data("value")},itemArray:function(t,i,s="",a=""){return e.extend({id:i,name:s,message:a},"emails"==t?{subject:""}:"popups"==t?{title:"",profile_image:""}:"design"==t?{title:"",color_1:"",color_2:"",color_3:"",background:"",brand:"",icon:""}:{})},hide:function(e=!0){G.find(" > .sb-tab > .sb-content").setClass("sb-hide",e)}},translations:{translations:{},originals:{},to_update:{},add:function(e){let t=ke.getSettingObject(z),i=t.attr("id"),s=z.find("[data-language].sb-active");this.save(t,!!s.length&&s.attr("data-language")),t.find('textarea,input[type="text"]').val(""),this.save(t,e),z.remove(),t.sbLanguageSwitcher(this.getLanguageCodes(i),"settings",e)},delete:function(e,t){let i=(e=ke.getSettingObject(e)).attr("id");delete this.translations[t][i],e.find(`.sb-language-switcher [data-language="${t}"]`).remove(),this.activate(e)},activate:function(e,t=!1){let i=(e=ke.getSettingObject(e)).attr("id"),s=t?this.translations[t][i]:this.originals[i];if("string"==typeof s)e.find("input, textarea").val(s);else for(var a in s)e.find("#"+a).find("input, textarea").val("string"==typeof s[a]?s[a]:s[a][0])},updateActive:function(){let t=R.find(".sb-translations-list"),i={front:{},admin:{},"admin/js":{},"admin/settings":{}},s=t.attr("data-value");if(!SBF.null(s)){for(var a in i)t.find(' > [data-area="'+a+'"] .sb-input-setting:not(.sb-new-translation)').each(function(){i[a][e(this).find("label").html()]=e(this).find("input").val()}),t.find('> [data-area="'+a+'"] .sb-new-translation').each(function(){let t=e(this).find("input:first-child").val(),s=e(this).find("input:last-child").val();t&&s&&(i[a][t]=s)});this.to_update[s]=i}},save:function(t,i=!1){t=ke.getSettingObject(t);let s={},a=e(t).attr("id");"multi-input"==t.data("type")?t.find(".multi-input-textarea,.multi-input-text").each(function(){s[e(this).attr("id")]=e(this).find("input, textarea").val()}):s=t.find("input, textarea").val(),i?(i in this.translations||(this.translations[i]={}),this.translations[i][a]=s):this.originals[a]=s},load:function(e){let t=R.find(".sb-translations > .sb-content");t.find(" > .sb-hide").removeClass("sb-hide"),this.updateActive(),SBF.ajax({function:"get-translation",language_code:e},i=>{e in this.to_update&&(i=this.to_update[e]);let s="",a=["front","admin","admin/js","admin/settings"];for(var n=0;n<a.length;n++){let e=i[a[n]];s+=`<div${n?"":' class="sb-active"'} data-area="${a[n]}">`;for(var o in e)s+=`<div class="sb-input-setting sb-type-text"><label>${o}</label><div><input type="text" value="${e[o]}"></div></div>`;s+="</div>"}t.find(".sb-translations-list").attr("data-value",e).html(s),t.find(".sb-menu-wide li").sbActive(!1).eq(0).sbActive(!0),t.sbLoading(!1)}),t.sbLoading(!0)},getLanguageCodes:function(e){let t=[];for(var i in this.translations)e in this.translations[i]&&t.push(i);return t}}},Ae={chart:!1,active_report:!1,initChart:function(e,t="line",i=1){let s=[],a=[],n=["#049CFF","#74C4F7","#B9E5FF","#0562A0","#003B62","#1F74C4","#436786"];for(var o in e)s.push(e[o][0]),a.push(o);if("line"!=t&&s.length>6)for(var r=0;r<s.length;r++)n.push("hsl(210, "+Math.floor(100*Math.random())+"%, "+Math.floor(100*Math.random())+"%)");this.chart&&this.chart.destroy(),this.chart=new Chart(V.find("canvas"),{type:t,data:{labels:a,datasets:[{data:s,backgroundColor:"line"==t?"#028be530":n,borderColor:"line"==t?"#049CFF":"#FFFFFF",borderWidth:0}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{callback:function(e,t,s){return 1==i?e:2==i?new Date(1e3*e).toISOString().substr(11,8):e},beginAtZero:!0}}],xAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{callbacks:{label:function(e,t){let a=e.index,n=t.datasets[0].data[a];switch(i){case 1:return n;case 2:return new Date(1e3*s[a]).toISOString().substr(11,8);case 3:return n+"%";case 4:let e=V.find(".sb-table tbody tr").eq(a).find("td");return e.eq(0).text()+" "+e.eq(1).text()}}},displayColors:!1}}})},initTable:function(e,t,i=!1){let s="<thead><tr>",a=t[Object.keys(t)[0]].length-1,n=[];for(r=0;r<e.length;r++)s+=`<th>${e[r]}</th>`;s+="</tr></thead><tbody>";for(var o in t)0!=t[o][a]&&n.push([o,t[o][a]]);i&&n.reverse();for(var r=0;r<n.length;r++)s+=`<tr><td><div>${n[r][0]}</div></td><td>${n[r][1]}</td></tr>`;s+="</tbody>",V.find("table").html(s)},initReport:function(e=!1,t=!1){let i=V.find(".sb-tab > .sb-content");t=SBF.null(t)?[!1,!1]:t.split(" - "),i.sbLoading(!0),e&&(this.active_report=e),this.active_report&&this.getData(this.active_report,t[0],t[1],e=>{0==e?i.addClass("sb-no-results-active"):(i.removeClass("sb-no-results-active"),this.initChart(e.data,e.chart_type,e.label_type),this.initTable(e.table,e.data,e["table-inverse"]),V.find(".sb-reports-title").html(e.title),V.find(".sb-reports-text").html(e.description),V.find(".sb-collapse-btn").remove(),de||l(V.find(".sb-collapse"),V.find("canvas").outerHeight()-135)),i.sbLoading(!1)})},getData:function(e,t=!1,i=!1,s){SBF.ajax({function:"reports",name:e,date_start:t,date_end:i,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},e=>{s(e)})},initDatePicker:function(){let e={ranges:{},locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:o("Apply"),cancelLabel:o("Cancel"),fromLabel:o("From"),toLabel:o("To"),customRangeLabel:o("Custom"),weekLabel:o("W"),daysOfWeek:[o("Su"),o("Mo"),o("Tu"),o("We"),o("Th"),o("Fr"),o("Sa")],monthNames:[o("January"),o("February"),o("March"),o("April"),o("May"),o("June"),o("July"),o("August"),o("September"),o("October"),o("November"),o("December")],firstDay:1},showCustomRangeLabel:!0,alwaysShowCalendars:!0,autoApply:!0};e.ranges[o("Today")]=[moment(),moment()],e.ranges[o("Yesterday")]=[moment().subtract(1,"days"),moment().subtract(1,"days")],e.ranges[o("Last 7 Days")]=[moment().subtract(6,"days"),moment()],e.ranges[o("Last 30 Days")]=[moment().subtract(29,"days"),moment()],e.ranges[o("This Month")]=[moment().startOf("month"),moment().endOf("month")],e.ranges[o("Last Month")]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],V.find("#sb-date-picker").daterangepicker(e).val("")}},Te={real_time:null,datetime_last_user:"2000-01-01 00:00:00",sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],user_main_fields:["id","first_name","last_name","email","password","profile_image","user_type","creation_time","token","last_activity","department"],search_query:"",init:!1,busy:!1,table_extra:!1,history:[],filter:function(e){e="all"==e?["visitor","lead","user"]:"agent"==e?["agent","admin"]:[e],this.user_types=e,this.loading(),le=1,ce=1;let t="online"==e[0]?["get-online-users",SB_ACTIVE_AGENT.id,this.sorting[0]]:["get-users",-1,this.sorting];SBF.ajax({function:t[0],sorting:t[2],user_types:e,search:this.search_query,extra:this.table_extra},e=>{this.populate(e),this.loading(!1)})},sort:function(e,t="DESC"){this.sorting=[e,t],this.loading(),le=1,ce=1,SBF.ajax({function:"get-users",sorting:this.sorting,user_types:this.user_types,search:this.search_query,extra:this.table_extra},e=>{this.populate(e),this.loading(!1)})},search:function(t){c(t,(t,i)=>{le=1,ce=1,SBF.ajax({function:t.length>1?"search-users":"get-users",search:t,user_types:this.user_types,sorting:this.sorting,extra:this.table_extra},s=>{this.user_types=["visitor","lead","user"],this.populate(s),this.search_query=t,e(i).sbLoading(!1),E.find("li").sbActive(!1).eq(0).sbActive(!0)})})},populate:function(t){let i="",s=t.length;if(s)for(var a=0;a<s;a++)i+=this.getRow(new SBUser(t[a],t[a].extra));else i=`<p class="sb-no-results">${o("No users found.")}</p>`;L.parent().scrollTop(0),L.find("tbody").html(i),this.user_types.includes("agent")&&SBF.ajax({function:"get-online-users",agents:!0},t=>{let i=[];for(var s=0;s<t.length;s++)i.push(t[s].id);L.find("[data-user-id]").each(function(){e(this).find(".sb-td-profile").addClass("sb-"+(i.includes(e(this).attr("data-user-id"))?"online":"offline"))})})},update:function(){if(!this.busy){let e=["user","visitor","lead","agent"],t=e.includes(this.user_types[0])&&""==this.search_query,i=E.find(".sb-active").data("type");"online"==i?this.filter(i):(this.busy=!0,SBF.ajax({function:"get-new-users",datetime:this.datetime_last_user},s=>{let a=s.length;if(this.busy=!1,a>0){let o="";for(n=0;n<a;n++){let e=new SBUser(s[n]);re[e.id]=e,this.updateMenu("add",e.type),t&&(o+=this.getRow(e))}if(t&&(L.find("tbody").prepend(o),e.includes(i))){let t="";for(var n=0;n<e.length;n++)t+=e[n]==i?"":`[data-user-type="${e[n]}"],`;L.find(t.slice(0,-1)).remove()}this.datetime_last_user=s[0].creation_time}}))}},getRow:function(e){if(e instanceof SBUser){let i="";for(var t=0;t<this.table_extra.length;t++){let s=this.table_extra[t];i+=`<td class="sb-td-${s}">${this.user_main_fields.includes(s)?e.get(s):e.getExtra(s)}</td>`}return`<tr data-user-id="${e.id}" data-user-type="${e.type}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img loading="lazy" src="${e.image}" /><span>${e.name}</span></a></td>${i}<td class="sb-td-email">${e.get("email")}</td><td class="sb-td-ut">${o(e.type)}</td><td>${SBF.beautifyTime(e.get("last_activity"),!0)}</td><td>${SBF.beautifyTime(e.get("creation_time"))}</td></tr>`}return SBF.error("User not of type SBUser","SBUsers.getRow"),!1},updateRow:function(e){let t=L.find(`[data-user-id="${e.id}"]`);if(t.length){let i=E.find(".sb-active").data("type");if(e.type==i||"admin"==e.type&&"agent"==i||"all"==i)t.replaceWith(this.getRow(e));else{let i=S.find(`[data-type="${"admin"==e.type?"agent":e.type}"] span`),s=parseInt(i.attr("data-count"));i.html(s+1).attr("data-count",s+1),t.remove()}}else L.find("tbody").append(this.getRow(e))},updateMenu:function(e="all",t=!1){let i=["all","user","lead","visitor"];"all"==e?SBF.ajax({function:"count-users"},e=>{for(var t=0;t<i.length;t++)this.updateMenuItem("set",i[t],e[i[t]])}):this.updateMenuItem(e,t)},updateMenuItem:function(e="set",t=!1,i=1){let s=E.find(`[data-type="${t}"] span`),a=["user","lead","visitor"];"set"!=e&&(i=parseInt(s.attr("data-count"))+1*("add"==e?1:-1)),s.html(`(${i})`).attr("data-count",i),i=0;for(var n=0;n<a.length;n++)i+=parseInt(E.find(`[data-type="${a[n]}"] span`).attr("data-count"));E.find('[data-type="all"] span').html(`(${i})`).attr("data-count",i)},delete:function(e){if(this.loading(),Array.isArray(e)){if(SB_ADMIN_SETTINGS.cloud&&!(e=SBCloud.removeAdminID(e)).length)return;SBF.ajax({function:"delete-users",user_ids:e},()=>{for(var i=0;i<e.length;i++)delete re[e[i]],L.find(`[data-user-id="${e[i]}"]`).remove(),x.find(`[data-user-id="${e[i]}"]`).remove();0==L.find("[data-user-id]").length&&this.filter(E.find(".sb-active").data("type")),t("Users deleted"),this.updateMenu(),this.loading(!1)})}else re[e].delete(()=>{let s=x.find(`[data-user-id="${e}"]`);i().id==e&&i(!1),s.sbActive()&&(SBChat.conversation=!1,setTimeout(()=>{Ce.clickFirst()},300)),delete re[e],L.find(`[data-user-id="${e}"]`).remove(),s.remove(),S.sbHideLightbox(),t("User deleted"),this.updateMenu(),this.loading(!1)})},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e3))},stopRealTime:function(){clearInterval(this.real_time)},loading:function(e=!0){let t=I.find(".sb-loading-table");e?t.sbActive(!0):t.sbActive(!1)},csv:function(){SBF.ajax({function:"csv-users",users_id:Te.getSelected()},e=>window.open(e))},updateUsersActivity:function(){SBF.updateUsersActivity(be?SB_ACTIVE_AGENT.id:-1,i()?i().id:-1,function(e){Te.setActiveUserStatus("online"==e)})},setActiveAgentStatus:function(e=!0){be=e,_.find('[data-value="status"]').html(o(e?"Online":"Offline")).attr("class",e?"sb-online":"sb-offline"),SBPusher.active&&(e?SBPusher.presence():SBPusher.presenceUnsubscribe())},setActiveUserStatus:function(e=!0){let t=y.find(".sb-conversation .sb-top > .sb-labels");t.find(".sb-status-online").remove(),e&&t.prepend(`<span class="sb-status-online">${o("Online")}</span>`),SBChat.user_online=e},onlineUserNotification:function(e){let t=SB_ADMIN_SETTINGS["online-users-notification"];if(t){let i=e.info.first_name+" "+e.info.last_name,s=this.userProfileImage(e.info.profile_image);SB_ADMIN_SETTINGS["push-notifications"]&&"id"in e.info&&!this.history.includes(e.info.id)?SBF.ajax({function:"push-notification",title:t,message:i,icon:s,interests:SB_ACTIVE_AGENT.id,user_id:e.info.id}):Ce.desktop_notifications&&SBChat.desktopNotification(t,i,s,!1,e.info.id),this.history.push(e.info.id)}},userProfileImage:function(e){return!e||e.indexOf("user.svg")?SB_ADMIN_SETTINGS["notifications-icon"]:e},getSelected:function(){let t=[];return L.find("tr").each(function(){e(this).find('td input[type="checkbox"]').is(":checked")&&t.push(e(this).attr("data-user-id"))}),t}},Ce={real_time:null,datetime_last_conversation:"2000-01-01 00:00:00",user_typing:!1,desktop_notifications:!1,flash_notifications:!1,busy:!1,is_search:!1,menu_count_ajax:!1,open:function(e=-1,t){-1!=e&&this.openConversation(e,t),S.sbHideLightbox(),_.find(".sb-admin-nav a").sbActive(!1).parent().find("#sb-conversations").sbActive(!0),S.find(" > main > div").sbActive(!1),y.sbActive(!0).find(".sb-board").removeClass("sb-no-conversation"),this.startRealTime()},openConversation:function(t,s=!1,a=!0){if(!1===s&&t)SBF.ajax({function:"get-user-from-conversation",conversation_id:t},e=>{SBF.null(e.id)?SBF.error("Conversation not found","SBAdmin.openConversation"):this.openConversation(t,e.id,a)});else{let n=y.find(".sb-conversation .sb-list"),r=SBF.null(re[s])||!("email"in re[s].details),l=y.find(`[data-conversation-id="${t}"]`);n.html(""),n.sbLoading(!0),r?(i(new SBUser({id:s})),i().update(()=>{re[s]=i(),this.updateUserDetails()})):(i(re[s]),this.updateCurrentURL()),SBPusher.active&&(SBPusher.event("client-typing",e=>{e.user_id==i().id&&(Ce.typing(!0),clearTimeout(Y),Y=setTimeout(()=>{Ce.typing(!1)},1e3))}),SBPusher.event("new-message",()=>{SBChat.update()}),SBPusher.event("agent-active-conversation-changed",e=>{e.previous_conversation_id==t&&y.find(".sb-conversation-busy").remove()},"agents"),SBPusher.event("init",e=>{Ce.updateCurrentURL(e.current_url)}),SBPusher.event("message-status-update",e=>{SBChat.conversation&&SBChat.conversation.updateMessagesStatus(e.message_ids)})),SB_ADMIN_SETTINGS["smart-reply"]&&$.html(""),x.find("li").sbActive(!1),l.sbActive(!0),-1!=t?i().getFullConversation(t,t=>{let s=t.get("conversation_status_code"),r=B.eq(0),c=r.find(".sb-active").attr("data-value");if(SBChat.setConversation(t),SBChat.populate(),this.setReadIcon(s),y.find(".sb-conversation-busy").remove(),this.updateUserDetails(),y.find(".sb-top > a").html(t.get("title")),Fe.must_translate=SB_ADMIN_SETTINGS.translation&&i().language&&SB_ADMIN_SETTINGS["active-agent-language"]!=i().language,Fe.must_translate){let e=[],i=[],s=[];for(h=0;h<t.messages.length;h++){let a=t.messages[h];("bot"!=a.get("user_type")||SB_ADMIN_SETTINGS.multilingual_translation)&&a.message&&(e.push(a.message),i.push(a.id),s.push(a.get("user_type")))}e.length&&Be.dialogflow.translate(e,SB_ADMIN_SETTINGS["active-agent-language"],e=>{if(e)for(var t=0;t<e.length;t++){let a=SBChat.conversation.getMessage(i[t]);a&&(a.set("translation",e[t]),n.find(`[data-id="${i[t]}"]`).replaceWith(a.getCode(!0)),n.find(`[data-id="${i[t]}"] .sb-menu`).prepend(`<li data-value="original">${o(SBF.isAgent(s[t])?"View translation":"View original message")}</li>`))}SB_ADMIN_SETTINGS["smart-reply"]&&this.openConversation_1(SBChat.conversation,$)})}let d=y.find("#conversation-department");if(d.length){let e=d.find(`[data-id="${t.get("department")}"]`);d.find(" > p").attr("data-value",e.data("value")).html(e.html())}let u=y.find("#conversation-agent");if(u.length){let e=u.find(`[data-id="${t.get("agent_id")}"]`);u.find(" > p").attr("data-value",e.data("id")).html(e.html())}[1,2].includes(s)&&(s=0),c==s||e(w).find(".sb-search-btn").sbActive()||(r.find(`[data-value="${s}"]`).click(),r.find("ul").sbActive(!1)),de&&this.mobileOpenConversation(),l.length||c!=s&&(0!=c||1!=s)||x.prepend(Ce.getListCode(t).replace("<li",'<li class="sb-active"')),l.sbActive(!0),a&&this.scrollTo();let p=t.get("busy");p&&y.find(".sb-editor > .sb-labels").prepend(`<span data-agent="${p.id}" class="sb-status-warning sb-conversation-busy">${p.first_name} ${p.last_name} ${o("is replying to this conversation")}</span>`),Be.is("woocommerce")&&Be.woocommerce.conversationPanel(),Be.is("ump")&&Be.ump.conversationPanel(),Be.is("perfex")&&Be.perfex.conversationPanel(),Be.is("whmcs")&&Be.whmcs.conversationPanel(),Be.is("aecommerce")&&Be.aecommerce.conversationPanel(),Be.is("martfury")&&Be.martfury.conversationPanel(),Be.is("armember")&&Be.armember.conversationPanel(),Be.is("zendesk")&&Be.zendesk.conversationPanel(),this.notes.update(t.details.notes),this.attachments(),SB_ADMIN_SETTINGS["smart-reply"]&&!Fe.must_translate&&this.openConversation_1(t,$);for(var h=t.messages.length-1;h>0;h--){let e=t.messages[h].get("payload"),i=!1;if(e&&"rich-messages"in e)for(var f in e["rich-messages"]){let t=e["rich-messages"][f];if("rating"==t.type){y.find(".sb-profile-list > ul").append(`<li data-id="rating"><i class="sb-icon sb-icon-${1==t.result.rating?"like":"dislike"}"></i><span>${o("User rating")}</span><label>${o(1==t.result.rating?"Helpful":"Not helpful")}</label></li>`),i=!0;break}}if(i)break}i().getConversations(function(e){y.find(".sb-user-conversations").html(i().getConversationsCode(e))}),n.sbLoading(!1)}):(SBChat.clear(),x.find("li").sbActive(!1),n.sbLoading(!1)),r||this.updateUserDetails(),y.find(".sb-board").removeClass("sb-no-conversation"),Te.updateUsersActivity(),this.startRealTime(),SBF.getURL("conversation")!=t&&u("?conversation="+t)}},openConversation_1:function(e,t){let i=e.getLastUserMessage();t.html(""),i&&i.payload("sb-human-takeover")&&(i=e.getLastUserMessage(i.get("index"))),i&&Be.dialogflow.smartReply(i.get("translation")?i.get("translation"):i.message)},populate:function(e,t,i){this.openConversation(e,t,i)},populateList:function(e){let t="";ee=[];for(var i=0;i<e.length;i++)t+=this.getListCode(e[i]),ee.push(e[i]);""==t&&(t=`<p class="sb-no-results">${o("No conversations found.")}</p>`),x.html(t),this.updateMenu(),SBF.event("SBAdminConversationsLoaded",{conversations:e})},update:function(){if(!this.busy&&0==B.eq(0).find("p").attr("data-value")&&(this.busy=!0,SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation},t=>{if(this.busy=!1,t.length){let a,n="",o="",r=SBChat.conversation?SBChat.conversation.id:-1,l=!1,c=[];this.datetime_last_conversation=t[0].creation_time;for(var s=0;s<t.length;s++)if(!c.includes(t[s].conversation_id)){let e=t[s],d=e.conversation_status_code,u=e.user_id,p=e.conversation_id,h=r==p,f=this.getListCode(e,0!=d&&2!=d||SBF.isAgent(e.message_user_type)?null:"new"),b=x.find(`[data-conversation-id="${p}"]`),g=b.index(),m=b.length,v=SBF.null(t[s].payload)?{}:JSON.parse(t[s].payload);if(h?(f=f.replace("<li",'<li class="sb-active"'),m?(e.message&&b.replaceWith(f),ee[g].conversation_status_code=d,this.setReadIcon(d)):l=!0):m&&(ee[g]=e,x.find(`[data-conversation-id="${p}"]`).remove()),u in re||(re[u]=new SBUser({id:u,first_name:e.first_name,last_name:e.last_name,profile_image:e.profile_image,user_type:e.user_type})),h&&m||(2==d||SB_ADMIN_SETTINGS["order-by-date"]&&(0==d||1==d)?(n+=f,ee.unshift(e)):0!=d&&1!=d||(0==(a=x.find('[data-conversation-status="2"]').last()).length?n+=f:(ee.splice(a.index()+1,0,e),o+=f)),u==i().id&&i().getConversations(function(e){y.find(".sb-user-conversations").html(i().getConversationsCode(e))}),SBF.event("SBAdminNewConversation",{conversation:e})),i()&&("event"in v&&"update-user"==v.event||re[u].type!=e.user_type)&&i().update(()=>{this.updateUserDetails(),re[i().id]=i()}),!SBChat.tab_active&&2==e.conversation_status_code&&(!SBF.isAgent(e.message_user_type)||"preview"in v)&&(!SBF.null(e.message)||!SBF.null(e.attachments)||"preview"in v)){if(this.desktop_notifications){let t=[e.first_name+" "+e.last_name,Te.userProfileImage(e.profile_image)];SBChat.desktopNotification(t[0],"preview"in v?v.preview:e.message,t[1],p,u)}this.flash_notifications&&SBChat.flashNotification(),SBChat.audio&&["a","c","ic"].includes(SB_ADMIN_SETTINGS.sound.code)&&SBChat.playSound()}c.push(p)}n&&x.prepend(n),o&&e(o).insertAfter(a),l&&this.scrollTo(),SBChat.tab_active&&this.hideNewLabel(),this.updateMenu()}}),SB_ADMIN_SETTINGS["assign-conversation-to-agent"]||SB_ACTIVE_AGENT.department)){let t=x.find(" > li").map(function(){return e(this).attr("data-conversation-id")}).get();t.length&&SBF.ajax({function:"check-conversations-assignment",conversation_ids:t,agent_id:!!SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SB_ACTIVE_AGENT.id,department:SB_ACTIVE_AGENT.department},e=>{if(e)for(var t=0;t<e.length;t++)x.find(`[data-conversation-id="${e[t]}"]`).remove()})}},updateMenu:function(){let e=x.find('[data-conversation-status="2"]').length,t=B.eq(0),i=t.find(" > p span");if(100==e||this.menu_count_ajax){let e=t.find("li.sb-active").data("value");this.menu_count_ajax=!0,SBF.ajax({function:"count-conversations",status_code:0==e?2:e},e=>{i.html(`(${e})`)})}else i.html(`(${e})`)},messageMenu:function(e){return`<i class="sb-menu-btn sb-icon-menu"></i><ul class="sb-menu">${Be.is("dialogflow")?`<li data-value="bot">${o("Send to Dialogflow")}</li>`:""}${e&&!SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS["allow-agent-delete-message"]||SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS["allow-supervisor-delete-message"]?`<li data-value="delete">${o("Delete")}</li>`:""}</ul>`},updateUserDetails(){i()&&(y.find(`[data-user-id="${i().id}"] .sb-name:not(.sb-custom-name),.sb-top > a`).html(i().name),y.find(".sb-user-details .sb-profile").setProfile(),$e.populate(i(),y.find(".sb-profile-list")))},setReadIcon(e){let t=2==e;y.find('.sb-top [data-value="read"],.sb-top [data-value="unread"]').sbActive([0,1,2].includes(parseInt(e))).attr("data-value",t?"read":"unread").attr("data-sb-tooltip",o(t?"Mark as read":"Mark as unread")).parent().sbInitTooltips().find("i").attr("class",t?"sb-icon-check-circle":"sb-icon-circle")},getListCode:function(e,t){e instanceof SBConversation&&(e={message:e.getLastMessage().message,attachments:e.getLastMessage().attachments,user_id:e.get("user_id"),conversation_id:e.id,conversation_status_code:e.get("conversation_status_code"),conversation_source:e.get("source"),profile_image:e.get("profile_image"),first_name:e.get("first_name"),last_name:e.get("last_name"),creation_time:e.get("creation_time"),payload:e.get("payload")});let i=e.message,s=new SBMessage,a=!SBF.null(e.title),n="";if(e.payload.includes("preview")){let t=JSON.parse(e.payload.replace("\\'","'"));t&&"preview"in t&&(i=t.preview)}if("new"===t&&(n='<span class="sb-label-new">'+o("New")+"</span>",t=null),SBF.null(t)&&(t=e.conversation_status_code),!i&&!SBF.null(e.attachments)){let t=JSON.parse(e.attachments);if(Array.isArray(t)){for(var r=0;r<t.length;r++)i+=t[r][0]+" ";i.length>114&&(i=i.substr(0,114)+" ...")}}return i.length>110&&(i=i.substr(0,110)+" ..."),`<li data-user-id="${e.user_id}" data-conversation-id="${e.conversation_id}" data-conversation-status="${t}"${SBF.null(e.conversation_source)?"":` data-conversation-source="${e.conversation_source}"`}>${n}<div class="sb-profile"><img loading="lazy" src="${e.profile_image}"><span class="sb-name${a?" sb-custom-name":""}">${a?e.title:e.first_name+" "+e.last_name}</span><span class="sb-time">${SBF.beautifyTime(e.creation_time)}</span></div><p>${s.strip(i)}</p></li>`},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime())},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},transcript:function(e,t,i=!1,s=!1){SBF.ajax({function:"transcript",conversation_id:e},e=>{"email"==i?SBChat.sendEmail(SB_ADMIN_SETTINGS["transcript-message"],[[e,e]],t,t=>{s&&s(!0===t?e:t)}):(s&&s(e),window.open(e))})},typing:function(e){e?(SBChat.user_online||Te.setActiveUserStatus(!0),this.user_typing||(y.find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing">'+o("Typing")+"</span>"),this.user_typing=!0)):this.user_typing&&(y.find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){let e=x.find(".sb-active"),t=e.length?e[0].offsetTop:0;x.parent().scrollTop(t-(de?120:70))},search:function(t){t&&c(t,(t,i)=>{if(oe=1,t.length>1)SBF.ajax({function:"search-conversations",search:t},t=>{Ce.populateList(t),e(i).sbLoading(!1),this.scrollTo(),this.is_search=!0});else{let t=Ce.filters();ne=1,SBF.ajax({function:"get-conversations",status_code:t[0],department:t[1],source:t[2]},t=>{Ce.populateList(t),e(i).sbLoading(!1),this.is_search=!1})}})},updateCurrentURL:function(e=!1){e?this.ucurl(e):SBChat.user_online&&i()&&i().getExtra("current_url")&&SBF.ajax({function:"current-url"},e=>{e&&this.ucurl(e)})},ucurl(e){let t=i().getExtra("current_url");e=h(e),y.find('.sb-profile-list [data-id="current_url"] label').attr("data-value",e).html(e),t&&(t.value=e,i().setExtra("current_url",t))},assignDepartment:function(e,t,i){SBF.ajax({function:"update-conversation-department",conversation_id:e,department:t,message:SBChat.conversation.getLastMessage().message},e=>{i(e)})},assignAgent:function(e,t,i=!1){SBF.ajax({function:"update-conversation-agent",conversation_id:e,agent_id:t,message:SBChat.conversation.getLastMessage().message},e=>{i&&i(e)})},setActiveDepartment:function(e){if(SBChat.conversation&&SBChat.conversation.get("department")==e)return;let i=y.find("#conversation-department"),s=i.find(`[data-id="${e}"]`);i.find(" > p").attr("data-value",s.data("value")).html(s.html()).next().sbActive(!1),SBChat.conversation.set("department",e),"agent"==SB_ACTIVE_AGENT.user_type&&SB_ACTIVE_AGENT.department&&SB_ACTIVE_AGENT.department!=e&&(x.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),Ce.clickFirst()),t("Department updated. The agents have been notified.")},setActiveAgent:function(e){let i=y.find("#conversation-agent"),s=i.find(`[data-id="${e}"]`);SBChat.conversation.set("agent_id",e),i.find(" > p").attr("data-value",s.data("value")).html(s.html()).next().sbActive(!1),"agent"!=SB_ACTIVE_AGENT.user_type||SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&!e||(x.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),Ce.clickFirst()),e&&t("Agent assigned. The agent has been notified.")},mobileOpenConversation:function(){y.find(".sb-admin-list").sbActive(!1),y.find(".sb-conversation").sbActive(!0),_.addClass("sb-hide")},mobileCloseConversation:function(){x.find("li.sb-active").sbActive(!1),y.find(".sb-admin-list").sbActive(!0),y.find(".sb-conversation,.sb-user-details").removeClass("sb-active"),S.find('.sb-menu-mobile [data-value="panel"]').sbActive(!1),_.removeClass("sb-hide"),window.history.replaceState({},document.title,SBF.URL())},clickFirst:function(){x.find("li:first-child").length?(x.find("li:first-child").click(),Ce.scrollTo()):y.find(".sb-board").addClass("sb-no-conversation")},savedReplies:function(t,i){let s=i.charAt(t.selectionStart-1);if("#"==s&&(SBChat.editor_listening=!0),SBChat.editor_listening&&" "==s){let s=i.substr(i.lastIndexOf("#")+1).replace(" ","");SBChat.editor_listening=!1;for(var a=0;a<ie.length;a++)if(ie[a]["reply-name"]==s)return void e(t).val(i.substr(0,i.lastIndexOf("#"))+ie[a]["reply-text"])}},attachments:function(){if(A.length){let i=SBChat.conversation.getAttachments(),s="";for(var t=0;t<i.length;t++)s+=`<a href="${i[t][1]}" target="_blank"><i class="sb-icon sb-icon-download"></i>${i[t][0]}</a>`;e(A).html(""==s?"":`<h3>${o("Attachments")}</h3><div class="sb-list-items sb-list-links sb-list-icon">${s}</div>`),l(A,160)}},filters:function(){let e=[];for(var t=0;t<B.length;t++)e.push(B.eq(t).find("li.sb-active").data("value"));return e},notes:{busy:!1,add:function(e,t,i,s,a=!1){SBF.ajax({function:"add-note",conversation_id:e,user_id:t,name:i,message:s},e=>{a&&a(e)})},update:function(e,t=!1){if(k.length){let s="",a=k.find(" > div");for(var i=0;i<e.length;i++){let t=e[i];s+=`<div data-id="${t.id}"><span>${t.name}${SB_ACTIVE_AGENT.id==t.user_id?'<i class="sb-delete-note sb-icon-close"></i>':""}</span><span>${t.message}</span></div>`}t?a.append(s):a.html(s),a.attr("style",""),k.find(".sb-collapse-btn").remove(),l(k,155),this.busy=!1}},delete:function(e,t,i=!1){this.busy||(this.busy=!0,SBF.ajax({function:"delete-note",conversation_id:e,note_id:t},e=>{this.busy=!1,i&&i(e)}))}},showDirectMessageBox:function(e,t=[]){let i="custom_email"==e;SBForm.clear(T),T.find(".sb-direct-message-users").val(t.length?t.join(","):"all"),T.find(".sb-bottom > div").html(""),T.find(".sb-top-bar > div:first-child").html(o(`Send a ${{sms:"text message",custom_email:"email",message:"chat message"}[e]}`)),T.find(".sb-loading").sbLoading(!1),T.find(".sb-direct-message-subject").sbActive(i).find("input").attr("required",i),T.attr("data-type",e),T.sbShowLightbox()},hideNewLabel:function(){setTimeout(()=>{x.find(".sb-label-new").addClass("sb-fade-out")},3e3)}},$e={getAll:function(e){return SBForm.getAll(e)},get:function(e){return SBForm.get(e)},set:function(e,t){return SBForm.set(e,t)},show:function(e){a(),i(new SBUser({id:e})),i().update(()=>{this.populate(i(),N.find(".sb-profile-list")),N.find(".sb-profile").setProfile(),i().getConversations(t=>{let s=i().type;SBF.isAgent(s)&&this.agentData(),N.find(".sb-user-conversations").html(i().getConversationsCode(t)),N.find(".sb-top-bar [data-value]").sbActive(!1),SBF.null(i().get("email"))||N.find(".sb-top-bar [data-value=email]").sbActive(!0),i().getExtra("phone")&&SB_ADMIN_SETTINGS.sms&&N.find(".sb-top-bar [data-value=sms]").sbActive(!0),this.boxClasses(N,s),N.attr("data-user-id",i().id).sbShowLightbox(),a(!1,!1),SBF.event("SBProfileBoxOpened",{user_id:e})}),re[e]=i(),SBF.getURL("user")!=e&&u("?user="+e)})},showEdit:function(e){if(!(e instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{let i=M.find("#password input"),s=e.type,a=M.find("#user_type select");M.removeClass("sb-user-new").attr("data-user-id",e.id),M.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Save changes")}`),M.find(".sb-profile").setProfile(),M.find(".sb-custom-detail").remove(),M.find("input,select,textara").removeClass("sb-error");let n="",r=M.find(".sb-additional-details [id]").map(function(){return this.id}).get().concat(["wp-id","perfex-id","whmcs-id","aecommerce-id","facebook-id","ip","os","current_url","country_code","browser_language","browser","martfury-id","martfury-session"]);for(var t in e.extra)r.includes(t)||(n+=`<div id="${t}" data-type="text" class="sb-input sb-custom-detail"><span>${o(e.extra[t].name)}</span><input type="text"></div>`);M.find(".sb-additional-details .sb-edit-box").append(n),this.populateEdit(e,M),this.updateRequiredFields(s),"admin"==SB_ACTIVE_AGENT.user_type&&SBF.isAgent(s)&&a.html(`<option value="agent">${o("Agent")}</option><option value="admin"${"admin"==s?" selected":""}>${o("Admin")}</option>`),i.val()&&i.val("********"),SB_ADMIN_SETTINGS.cloud&&M.setClass("sb-cloud-admin",SB_ADMIN_SETTINGS.cloud.id==e.id),this.boxClasses(M,s),M.sbShowLightbox(),SBF.event("SBProfileEditBoxOpened",{user_id:e.id})}},populate:function(e,t){let i=["first_name","last_name","password","profile_image"],s="";if(t.hasClass("sb-profile-list-conversation")&&SBChat.conversation){let e=SBChat.conversation.get("source");if(s=this.profileRow("conversation-id",SBChat.conversation.id,o("Conversation ID")),!SBF.null(e)){let t={fb:"Facebook",wa:"WhatsApp",tm:"Text message",ig:"Instagram",tg:"Telegram",tk:"Tickets",wc:"WeChat",em:"Email",tw:"Twitter",bm:"Business Messages",vb:"Viber",ln:"LINE"};s+=this.profileRow("conversation-source",t[e]?t[e]:e,o("Source"))}}"admin"!=SB_ACTIVE_AGENT.user_type&&i.push("token");for(var a in e.details)i.includes(a)||(s+=this.profileRow(a,e.get(a)));if(e.isExtraEmpty())SBF.ajax({function:"get-user-extra",user_id:e.id},i=>{for(var a=0;a<i.length;a++){let t=i[a].slug;e.setExtra(t,i[a]),s+=this.profileRow(t,i[a].value,i[a].name)}t.html(`<ul>${s}</ul>`),l(t,145)});else{for(var a in e.extra){let t=e.getExtra(a);s+=this.profileRow(a,t.value,t.name)}t.html(`<ul>${s}</ul>`),l(t,145)}},profileRow:function(e,t,i=e){if(""==t)return"";let s,a={id:"padlock","conversation-id":"padlock",full_name:"user",email:"envelope",phone:"phone",user_type:"user",last_activity:"calendar",creation_time:"calendar",token:"shuffle",currency:"currency",location:"marker",country:"marker",address:"marker",city:"marker",postal_code:"marker",os:"desktop",current_url:"next",timezone:"clock"},n=`<i class="sb-icon sb-icon-${e in a?a[e]:"plane"}"></i>`,r=!1;switch(e){case"last_activity":case"creation_time":t=SBF.beautifyTime(t);break;case"user_type":t=SBF.slugToString(t);break;case"country_code":case"language":case"browser_language":n=`<img src="${SB_URL}/media/flags/${t.toLowerCase()}.png" />`;break;case"browser":(s=t.toLowerCase()).includes("chrome")?r="chrome":s.includes("edge")?r="edge":s.includes("firefox")?r="firefox":s.includes("opera")?r="opera":s.includes("safari")&&(r="safari");break;case"os":(s=t.toLowerCase()).includes("windows")?r="windows":s.includes("mac")||s.includes("apple")||s.includes("ipad")||s.includes("iphone")?r="apple":s.includes("android")?r="android":s.includes("linux")?r="linux":s.includes("ubuntu")&&(r="ubuntu");break;case"conversation-source":r=t.toLowerCase();case"browser":case"os":case"conversation-source":r&&(n=`<img src="${SB_URL}/media/${"conversation-source"==e?"apps":"devices"}/${r}.svg" />`);break;case"current_url":t=h(t)}return`<li data-id="${e}">${n}<span>${o(SBF.slugToString(i))}</span><label>${t}</label></li>`},populateEdit:function(t,i){i.find(".sb-details .sb-input").each((i,s)=>{this.set(s,t.details[e(s).attr("id")])}),i.find(".sb-additional-details .sb-input").each((i,s)=>{let a=e(s).attr("id");a in t.extra?this.set(s,t.extra[a].value):this.set(s,"")})},clear:function(e){SBForm.clear(e)},errors:function(e){return SBForm.errors(e.find(".sb-details"))},showErrorMessage:function(e,t){SBForm.showErrorMessage(e,t)},agentData:function(){let e=`<div class="sb-title">${o("Feedback rating")}</div><div class="sb-rating-area sb-loading"></div>`,t=N.find(".sb-agent-area");t.html(e),SBF.ajax({function:"get-rating"},i=>{if(0==i[0]&&0==i[1])e=`<p class="sb-no-results">${o("No ratings yet.")}</p>`;else{let t=i[0]+i[1],s=100*i[0]/t,a=100*i[1]/t;e=`<div><div>${o("Helpful")}</div><span data-count="${i[0]}" style="width: ${Math.round(2*s)}px"></span><div>${s.toFixed(2)} %</div></div><div><div>${o("Not helpful")}</div><span data-count="${i[1]}" style="width: ${Math.round(2*a)}px"></span><div>${a.toFixed(2)} %</div></div><p class="sb-rating-count">${t} ${o("Ratings")}</p>`}t.find(".sb-rating-area").html(e).sbLoading(!1)})},boxClasses:function(t,i=!1){e(t).removeClass("sb-type-admin sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`${0!=i?`sb-type-${i}`:""} sb-agent-${SB_ACTIVE_AGENT.user_type}`)},updateRequiredFields:function(e){let t=SBF.isAgent(e);M.find("#password input").prop("required",t),M.find("#email input").prop("required",t)}},Fe={dialog:s,open_popup:!1,must_translate:!1,is_logout:!1,conversations:Ce,users:Te,settings:ke,profile:$e,apps:Be};window.SBAdmin=Fe,e(document).ready(function(){function l(e,i,s=0,a=[],n,r=!1,c=!1,d=!1,u=!1){let p={whatsapp:["whatsapp-send-template","messages"," a phone number.","direct-whatsapp"],email:["create-email","emails"," an email address.",!1],custom_email:["send-custom-email","emails"," an email address.","direct-emails"],sms:["send-sms","text messages"," a phone number.","direct-sms"]}[n];SBF.ajax({function:p[0],to:e[s].value,recipient_id:e[s].id,sender_name:SB_ACTIVE_AGENT.full_name,sender_profile_image:SB_ACTIVE_AGENT.profile_image,subject:r,message:i,template_name:c,parameters:d,template_languages:u,template:!1},c=>{let d=e.length,u="whatsapp"==n?S.find("#sb-whatsapp-send-template-box"):T;if(u.find(".sb-bottom > div").html(`${o("Sending")} ${o(p[1])}... ${s+1} / ${d}`),c){if(!0!==c&&("status"in c&&400==c.status||"error"in c&&![131030,131009].includes(c.error.code)))return SBForm.showErrorMessage(u,c.error?c.error.message:`${c.message} Details at ${c.more_info}`),console.error(c),u.find(".sb-loading").sbLoading(!1),void u.find(".sb-bottom > div").html("");if(s<d-1)return l(e,i,s+1,a,n,r);a.length?l(a,i,0,[],"sms",!1):(S.sbHideLightbox(),p[3]&&SBF.ajax({function:"reports-update",name:p[3],value:i.substr(0,18)+" | "+d})),t(1==d?"The message has been sent.":o("The message was sent to sent to all users who have"+p[2]))}else console.warn(c)})}if(S=e(".sb-admin"),_=S.find("> .sb-header"),y=S.find(".sb-area-conversations"),w=y.find(".sb-admin-list"),x=w.find(".sb-scroll-area ul"),B=w.find(".sb-select"),I=S.find(".sb-area-users"),L=I.find(".sb-table-users"),E=I.find(".sb-menu-users"),N=S.find(".sb-profile-box"),M=S.find(".sb-profile-edit-box"),R=S.find(".sb-area-settings"),G=R.find(".sb-automations-area"),H=G.find(".sb-conditions"),P=G.find(" > .sb-select"),O=G.find(" > .sb-tab > .sb-nav > ul"),V=S.find(".sb-area-reports"),D=R.find(".sb-articles-area"),j=D.find(".sb-article-categories select"),U=D.find(".sb-article-parent-category select"),te=y.find(".sb-replies"),K=S.find(".sb-lightbox-overlay"),Q=typeof SB_URL!=me?SB_URL.substr(0,SB_URL.indexOf("-content")-3):"",se=y.find(".sb-woocommerce-products"),ae=se.find(" > div > ul"),k=y.find(".sb-panel-notes"),A=y.find(".sb-panel-attachments"),T=S.find(".sb-direct-message-box"),ve=Be.is("wordpress")&&e(".wp-admin").length,C=S.find(".sb-dialogflow-intent-box"),$=y.find(".sb-editor > .sb-suggestions"),F=y.find(".sb-btn-open-ai"),window.onpopstate=function(){S.sbHideLightbox(),de&&y.sbActive()&&y.find(".sb-conversation").sbActive()&&Ce.mobileCloseConversation(),SBF.getURL("user")?(I.sbActive()||_.find(".sb-admin-nav #sb-users").click(),$e.show(SBF.getURL("user"))):SBF.getURL("area")?_.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click():SBF.getURL("conversation")?(y.sbActive()||_.find(".sb-admin-nav #sb-conversations").click(),Ce.openConversation(SBF.getURL("conversation"))):SBF.getURL("setting")?(R.sbActive()||_.find(".sb-admin-nav #sb-settings").click(),R.find("#tab-"+SBF.getURL("setting")).click()):SBF.getURL("report")&&(V.sbActive()||_.find(".sb-admin-nav #sb-reports").click(),V.find("#"+SBF.getURL("report")).click())},SBF.getURL("area")&&setTimeout(()=>{_.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click()},300),typeof SB_ADMIN_SETTINGS==me){let t=S.find(".sb-intall");return void e(S).on("click",".sb-submit-installation",function(){if(n(this))return;let i=!1,s=t.find("#first-name").length;if(SBForm.errors(t))i=s?"All fields are required. Minimum password length is 8 characters. Be sure you've entered a valid email.":"All fields are required.";else if(s&&t.find("#password input").val()!=t.find("#password-check input").val())i="The passwords do not match.";else{let s=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,"");s.includes("?")&&(s=s.substr(0,s.indexOf("?"))),e.ajax({method:"POST",url:s+"/include/ajax.php",data:{function:"installation",details:e.extend(SBForm.getAll(t),{url:s})}}).done(a=>{if(0!=(a=JSON.parse(a))){if(!0===(a=a[1]))return void setTimeout(()=>{window.location.href=s+"/admin.php?refresh=true"},1e3);switch(a){case"connection-error":i="Support Board cannot connect to the database. Please check the database information and try again.";break;case"missing-details":i="Missing database details! Please check the database information and try again.";break;case"missing-url":i="Support Board cannot get the plugin URL.";break;default:i=a}}else i=a;!1!==i&&(SBForm.showErrorMessage(t,i),e("html, body").animate({scrollTop:0},500)),e(this).sbLoading(!1)})}!1!==i&&(SBForm.showErrorMessage(t,i),e("html, body").animate({scrollTop:0},500),e(this).sbLoading(!1))})}if(!S.length)return;if(a(),S.removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&S.addClass("sb-pwa"),Be.is("woocommerce")&&(se=y.find(".sb-woocommerce-products"),ae=se.find(" > div > ul")),pe&&r(),S.find(" > .sb-rich-login").length)return;SB_ADMIN_SETTINGS.pusher?(SBPusher.active=!0,SBPusher.init(()=>{SBPusher.presence(1,()=>{Te.updateUsersActivity()}),SBPusher.event("update-conversations",()=>{Ce.update()},"agents"),SBPusher.event("set-agent-status",e=>{e.agent_id==SB_ACTIVE_AGENT.id&&Te.setActiveAgentStatus("online"==e.status)},"agents"),v()})):(v(),setInterval(function(){Te.updateUsersActivity()},1e4)),Te.table_extra=L.find("th[data-extra]").map(function(){return e(this).attr("data-field")}).get(),typeof SB_CLOUD_FREE!=me&&SB_CLOUD_FREE&&setTimeout(()=>{location.reload()},36e5),e(window).on("beforeunload",function(){i()&&SBF.ajax({function:"on-close"})}),e(window).keydown(function(e){let t=e.which,s=!1;if([13,27,32,37,38,39,40,46].includes(t)){if(S.find(".sb-dialog-box").sbActive()){let e=S.find(".sb-dialog-box");switch(t){case 46:case 27:e.find(".sb-cancel").click();break;case 32:case 13:e.find("info"!=e.attr("data-type")?".sb-confirm":".sb-close").click()}s=!0}else if([38,40,46].includes(t)&&y.sbActive()){if(46==t){if(y.find(".sb-editor textarea").is(":focus"))return;let e=y.find(" > div > .sb-conversation");e.find('.sb-top [data-value="'+(3==e.attr("data-conversation-status")?"delete":"archive")+'"]').click(),s=!0}else if(e.ctrlKey){let e=x.find(".sb-active");40==t?e.next().click():e.prev().click(),Ce.scrollTo(),s=!0}}else if([37,39].includes(t)&&I.sbActive()&&S.find(".sb-lightbox").sbActive()){let e=L.find(`[data-user-id="${i().id}"]`);(e=39==t?e.next():e.prev()).length&&(S.sbHideLightbox(),$e.show(e.attr("data-user-id"))),s=!0}else if([46,27].includes(t))if(S.find(".sb-lightbox").sbActive())S.sbHideLightbox(),s=!0;else{let e=S.find(".sb-search-btn.sb-active");e.length&&(e.find("i").click(),s=!0)}s&&e.preventDefault()}}),e(document).on("click keydown mousemove",function(){SBF.debounce(function(){SBChat.tab_active||SBF.visibilityChange(),SBChat.tab_active=!0,clearTimeout(ge),ge=setTimeout(()=>{SBChat.tab_active=!1},1e4)},"#3",8e3)}),document.onpaste=function(e){let t=e.clipboardData.items[0];if(0===t.type.indexOf("image")){var i=new FileReader;i.onload=function(e){SBChat.insertText(`[image url="${e.target.result}"]`)},i.readAsDataURL(t.getAsFile())}};let c=["Please go to Settings > Miscellaneous and enter the Envato Purchase Code of Support Board.",`${o("Your license key is expired. Please purchase a new license")} <a href="https://board.support/shop/{R}" target="_blank">${o("here")}</a>.`];e(_).on("click",".sb-version",function(){let e=S.find(".sb-updates-box");SBF.ajax({function:"get-versions"},t=>{let i="",s={sb:"Support Board",slack:"Slack",dialogflow:"Dialogflow",tickets:"Tickets",woocommerce:"Woocommerce",ump:"Ultimate Membership Pro",perfex:"Perfex",whmcs:"WHMCS",aecommerce:"Active eCommerce",messenger:"Messenger",whatsapp:"WhatsApp",armember:"ARMember",telegram:"Telegram",viber:"Viber",line:"LINE",wechat:"WeChat",twitter:"Twitter",zendesk:"Zendesk",gbm:"Google Business Messages",martfury:"Martfury"},n=!1;for(var r in t)if(Be.is(r)){let e=SB_VERSIONS[r]==t[r];e||(n=!0),i+=`<div class="sb-input"><span>${s[r]}</span><div${e?' class="sb-green"':""}>${o(e?"You are running the latest version.":"Update available! Please update now.")} ${o("Your version is")} V ${SB_VERSIONS[r]}.</div></div>`}n?e.find(".sb-update").removeClass("sb-hide"):e.find(".sb-update").addClass("sb-hide"),a(!1),e.find(".sb-main").prepend(i),e.sbShowLightbox()}),a(!0),e.sbActive(!1),e.find(".sb-input").remove()}),e(S).on("click",".sb-updates-box .sb-update",function(){if(n(this))return;let i=S.find(".sb-updates-box");SBF.ajax({function:"update",domain:SB_URL},s=>{let a="";if(SBF.errorValidation(s,"envato-purchase-code-not-found"))a=c[0];else if(SBF.errorValidation(s))a=SBF.slugToString(s[1]);else{let e=!0;for(var n in s)if("success"!=s[n]){e=!1,"expired"==s[n]&&(a=c[1].replace("{R}",n));break}e||a||(a=JSON.stringify(s))}r(),a?SBForm.showErrorMessage(i,a):(t("Update completed."),location.reload()),e(this).sbLoading(!1)})}),setTimeout(function(){let e=SBF.storage("last-update-check"),i=[he.getMonth(),he.getDate()];SB_ADMIN_SETTINGS.cloud||(0==e||i[0]!=e[0]||i[1]>e[1]+10)&&(SBF.storage("last-update-check",i),SB_ADMIN_SETTINGS["auto-updates"]?SBF.ajax({function:"update",domain:SB_URL},e=>{"string"==typeof e||Array.isArray(e)||(t("Automatic update completed. Reload the admin area to apply the update."),r())}):"admin"==SB_ACTIVE_AGENT.user_type&&SBF.ajax({function:"updates-available"},e=>{!0===e&&t(`${o("Update available.")} <span onclick="$('.sb-version').click()">${o("Click here to update now")}</span>`,"info")}))},1e3),e(S).on("click",".sb-apps > div",function(){let t=S.find(".sb-app-box"),i=e(this).data("app"),s="?utm_source=plugin&utm_medium=admin_area&utm_campaign=plugin";SBF.ajax({function:"app-get-key",app_name:i},e=>{t.find("input").val(e)}),t.find("input").val(""),t.find(".sb-top-bar > div:first-child").html(e(this).find("h2").html()),t.find("p").html(e(this).find("p").html()),t.attr("data-app",i),t.find(".sb-btn-app-setting").sbActive(Be.is(i)),t.find(".sb-btn-app-puchase").attr("href","https://board.support/shop/"+i+s),t.find(".sb-btn-app-details").attr("href","https://board.support/"+i+s),t.sbShowLightbox()}),e(S).on("click",".sb-app-box .sb-activate",function(){let i=S.find(".sb-app-box"),s=i.find("input").val(),a=i.attr("data-app");if(s){if(n(this))return;SBF.ajax({function:"app-activation",app_name:a,key:s},a=>{if(SBF.errorValidation(a)){let t="";t="envato-purchase-code-not-found"==(a=a[1])?c[0]:"invalid-key"==a?"It looks like your license key is invalid. If you believe this is an error, please contact support.":"expired"==a?c[1].replace("{R}",s):"Error: "+a,SBForm.showErrorMessage(i,t),e(this).sbLoading(!1)}else t("Activation complete! Page reload in progress..."),setTimeout(function(){location.reload()},1e3)})}else SBForm.showErrorMessage(i,"Please insert the license key.")}),e(S).on("click",".sb-app-box .sb-btn-app-setting",function(){R.find("#tab-"+e(this).closest("[data-app]").attr("data-app")).click(),S.sbHideLightbox()}),typeof Notification===me||"all"!=SB_ADMIN_SETTINGS["desktop-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["desktop-notifications"]||SB_ADMIN_SETTINGS["push-notifications"]||(Ce.desktop_notifications=!0),"all"!=SB_ADMIN_SETTINGS["flash-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["flash-notifications"]||(Ce.flash_notifications=!0),he.getDate()!=SBF.storage("admin-clean")&&setTimeout(function(){SBF.ajax({function:"cron-jobs"}),SBF.storage("admin-clean",he.getDate())},1e4),e(S).on("click",".sb-collapse-btn",function(){let t=e(this).sbActive(),i=t?e(this).parent().data("height")+"px":"";e(this).html(o(t?"View more":"Close")),e(this).parent().find("> div, > ul").css({height:i,"max-height":i}),e(this).sbActive(!t)}),e(S).on("click",".sb-popup-close",function(){S.sbHideLightbox()}),de&&(e(S).on("click",".sb-menu-mobile > i",function(){e(this).toggleClass("sb-active"),Fe.open_popup=e(this).parent()}),e(S).on("click",".sb-menu-mobile a",function(){e(this).closest(".sb-menu-mobile").find(" > i").sbActive(!1)}),e(S).on("click",".sb-menu-wide,.sb-nav",function(){e(this).toggleClass("sb-active")}),e(S).on("click",".sb-menu-wide > ul > li, .sb-nav > ul > li",function(t){let i=e(this).parent().parent();return i.find("li").sbActive(!1),i.find("> div:not(.sb-menu-wide):not(.sb-btn)").html(e(this).html()),i.sbActive(!1),i.find("> .sb-menu-wide").length&&i.closest(".sb-scroll-area").scrollTop(i.next()[0].offsetTop-(S.hasClass("sb-header-hidden")?70:130)),t.preventDefault(),!1}),e(S).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area,.sb-area-settings > .sb-tab > .sb-scroll-area,.sb-area-reports > .sb-tab > .sb-scroll-area").on("scroll",function(){let t=e(this).scrollTop();ue.last<t-10&&ue.header?(S.addClass("sb-header-hidden"),ue.header=!1):ue.last>t+10&&!ue.header&&!ue.always_hidden&&(S.removeClass("sb-header-hidden"),ue.header=!0),ue.last=t}),e(S).on("click",".sb-search-btn i,.sb-filter-btn i",function(){e(this).parent().sbActive()?(S.addClass("sb-header-hidden"),ue.always_hidden=!0):(ue.always_hidden=!1,x.parent().scrollTop()<10&&S.removeClass("sb-header-hidden"))}),e(S).on("click",".sb-top .sb-btn-back",function(){Ce.mobileCloseConversation()}),e(L).find("th:first-child").html(o("Order by")),e(L).on("click","th:first-child",function(){e(this).parent().toggleClass("sb-active")}),document.addEventListener("touchstart",e=>{Se=e.changedTouches[0].clientX,_e=e.changedTouches[0].clientY},!1),document.addEventListener("touchmove",e=>{if(Se&&_e){var t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY,a=Se-t,n=_e-s;if(Math.abs(a)>Math.abs(n))if(y.sbActive()){let e=x.find(".sb-active");a>0?e.next().click():e.prev().click()}else if(I.sbActive()&&S.find(".sb-lightbox").sbActive()){let e=L.find(`[data-user-id="${i().id}"]`);(e=a>0?e.next():e.prev()).length&&(S.sbHideLightbox(),$e.show(e.attr("data-user-id")))}Se=!1,_e=!1}},!1)),e(window).width()<913&&e(y).on("click","> .sb-btn-collapse",function(){e(this).toggleClass("sb-active"),y.find(e(this).hasClass("sb-left")?".sb-admin-list":".sb-user-details").toggleClass("sb-active")}),e(_).on("click"," .sb-admin-nav a",function(){let t=e(this).attr("id");switch(_.find(".sb-admin-nav a").sbActive(!1),S.find(" > main > div").sbActive(!1),S.find("."+e(this).attr("id").replace("sb-","sb-area-")).sbActive(!0),e(this).sbActive(!0),SBF.deactivateAll(),t){case"sb-conversations":de||SBF.getURL("conversation")||Ce.clickFirst(),Ce.update(),Ce.startRealTime(),Te.stopRealTime();break;case"sb-users":Te.startRealTime(),Ce.stopRealTime(),Te.init||(a(),le=1,ce=1,SBF.ajax({function:"get-users",user_types:["user","visitor","lead"],extra:Te.table_extra},e=>{Te.populate(e),Te.updateMenu(),Te.init=!0,Te.datetime_last_user=SBF.dateDB("now"),a(!1)}));break;case"sb-settings":ke.init||(a(),SBF.ajax({function:"get-all-settings"},e=>{if(e){let i=e["external-settings-translations"];ke.initHTML(e),ke.translations.translations=Array.isArray(i)&&!i.length?{}:i,delete e["external-settings-translations"];for(var t in e)ke.set(t,e[t])}ke.initPlugins(),ke.init=!0,a(!1)})),Te.stopRealTime(),Ce.stopRealTime();break;case"sb-reports":V.sbLoading()&&e.getScript(SB_URL+"/vendor/moment.min.js",()=>{e.getScript(SB_URL+"/vendor/daterangepicker.min.js",()=>{e.getScript(SB_URL+"/vendor/chart.min.js",()=>{Ae.initDatePicker(),Ae.initReport("conversations"),V.sbLoading(!1)})})}),Te.stopRealTime(),Ce.stopRealTime()}let i=t.substr(3);SBF.getURL("area")!=i&&("conversations"==i&&!SBF.getURL("conversation")||"users"==i&&!SBF.getURL("user")||"settings"==i&&!SBF.getURL("setting")||"reports"==i&&!SBF.getURL("report"))&&u("?area="+i)}),e(_).on("click",".sb-profile",function(){e(this).next().toggleClass("sb-active")}),e(_).on("click",'[data-value="logout"],.logout',function(){Fe.is_logout=!0,SBF.ajax({function:"on-close"}),Te.stopRealTime(),Ce.stopRealTime(),setTimeout(()=>{SBF.logout()},300)}),e(_).on("click",'[data-value="edit-profile"],.edit-profile',function(){a();let e=new SBUser({id:SB_ACTIVE_AGENT.id});e.update(()=>{i(e),y.find(".sb-board").addClass("sb-no-conversation"),x.find(".sb-active").sbActive(!1),$e.showEdit(e)})}),e(_).on("click",'[data-value="status"]',function(){Te.setActiveAgentStatus(!e(this).hasClass("sb-online"))}),e(_).find(".sb-account").setProfile(SB_ACTIVE_AGENT.full_name,SB_ACTIVE_AGENT.profile_image),e(x).on("click","li",function(){Ce.openConversation(e(this).attr("data-conversation-id"),e(this).attr("data-user-id"),!1),SBF.deactivateAll()}),e(S).on("click",".sb-user-conversations li",function(){Ce.openConversation(e(this).attr("data-conversation-id"),i().id,e(this).attr("data-conversation-status"))}),e(y).on("click",".sb-top ul a",function(){let t=-1,a="The conversation will be ",r=e(this).attr("data-value"),l=SBChat.conversation,c=(t,i)=>{let s=t.includes(".txt");e(this).sbLoading(!1),"email"==i&&actionshowResponse(s?o("Transcript sent to user's email.")+' <a href="'+t+'" target="_blank">'+o("View transcript")+"</a>":"Transcript sending error: "+t,s?"":"error")};switch(r){case"inbox":t=0,a+="restored.";break;case"archive":a+="archived.",t=3;break;case"delete":a+="deleted.",t=4;break;case"empty-trash":t=5,a="All conversations in the trash (including their messages) will be deleted permanently.";break;case"transcript":let s=e(this).attr("data-action");"email"!=s||i()&&i().get("email")||(s=""),Ce.transcript(l.id,l.get("user_id"),s,e=>c(e,s)),n(this);break;case"read":t=0,a+="marked as read.";break;case"unread":t=2,a+="marked as unread.";break;case"panel":e([y.find(".sb-user-details"),this]).toggleClass("sb-active")}-1!=t&&s(a,"alert",function(){SBF.ajax({function:"update-conversation-status",conversation_id:l.id,status_code:t},()=>{if([0,3,4].includes(t))for(var e=0;e<ee.length;e++)if(ee[e].conversation_id==l.id){ee[e].conversation_status_code=t;break}SB_ADMIN_SETTINGS["close-message"]&&3==t&&(SBF.ajax({function:"close-message",conversation_id:l.id,bot_id:SB_ADMIN_SETTINGS["bot-id"]}),SB_ADMIN_SETTINGS["close-message-transcript"]&&Ce.transcript(l.id,l.get("user_id"),"email",e=>c(e))),[0,2].includes(t)&&(x.find(".sb-active").attr("data-conversation-status",t),Ce.setReadIcon(t)),"inbox"!=r&&[0,2].includes(t)||(B.eq(0).find("li.sb-active").click(),B.eq(0).find("ul").sbActive(!1)),Be.is("slack")&&[3,4].includes(t)&&SBF.ajax({function:"archive-slack-channels",conversation_user_id:SBChat.conversation.get("user_id")})}),SBChat.conversation&&SBChat.conversation.id==l.id&&SBChat.conversation.set("conversation_status_code",t)})}),SBF.ajax({function:"saved-replies"},e=>{let t=`<p class="sb-no-results">${o("No saved replies found. Add new saved replies via Settings > Admin.")}</p>`;if(Array.isArray(e)&&e.length>0&&e[0]["reply-name"]){t="",ie=e;for(var i=0;i<e.length;i++)t+=`<li><div>${e[i]["reply-name"]}</div><div>${e[i]["reply-text"].replace(/\\n/g,"\n")}</div></li>`}te.find(".sb-replies-list > ul").html(t).sbLoading(!1)}),e(y).on("click",".sb-btn-saved-replies",function(){te.sbTogglePopup(this)}),e(y).on("click",".sb-btn-open-ai",function(){if(!SBChat.conversation||n(this))return;let t=y.find(".sb-editor textarea");Be.openAI.rewrite(t.val(),!SBChat.conversation.getUserMessages("agents").length,i=>{e(this).sbLoading(!1),i[0]&&(t.val(""),SBChat.insertText(i[1]))})}),e(te).on("click",".sb-replies-list li",function(){SBChat.insertText(e(this).find("div:last-child").html()),SBF.deactivateAll(),S.removeClass("sb-popup-active")}),e(te).on("input",".sb-search-btn input",function(){let t=e(this).val().toLowerCase();SBF.search(t,()=>{let e="",i=!(t.length>1);for(var s=0;s<ie.length;s++)(i||ie[s]["reply-name"].toLowerCase().includes(t)||ie[s]["reply-text"].toLowerCase().includes(t))&&(e+=`<li><div>${ie[s]["reply-name"]}</div><div>${ie[s]["reply-text"]}</div></li>`);te.find(".sb-replies-list > ul").html(e)})}),e(w).find(".sb-scroll-area").on("scroll",function(){if(!fe&&!Ce.is_search&&d(this,!0)&&oe){let e=y.find(".sb-admin-list"),t=Ce.filters();fe=!0,e.append('<div class="sb-loading-global sb-loading"></div>'),SBF.ajax({function:"get-conversations",pagination:ne,status_code:t[0],department:t[1],source:t[2]},t=>{if(setTimeout(()=>{fe=!1},500),oe=t.length){let e="";for(var i=0;i<oe;i++)e+=Ce.getListCode(t[i]),ee.push(t[i]);ne++,x.append(e),d(this,!1,1e3)}e.find(" > .sb-loading").remove(),SBF.event("SBAdminConversationsLoaded",{conversations:t})})}}),e(document).on("SBMessageDeleted",function(){let e=SBChat.conversation.getLastMessage();0!=e?x.find("li.sb-active p").html(e.message):(x.find("li.sb-active").remove(),Ce.clickFirst(),Ce.scrollTo())}),e(document).on("SBMessageSent",function(i,a){let n=a.conversation_id,r=x.find(`[data-conversation-id="${n}"]`),l=o("Error. Message not sent to"),c=a.conversation,d=a.user;a.message&&r.find("p").html(a.message),-1!=a.conversation_status_code&&(r.attr("data-conversation-status",a.conversation_status_code),Ce.updateMenu()),Be.messenger.check(c)&&Be.messenger.send(d.getExtra("facebook-id").value,c.get("extra"),a.message,a.attachments,a.message_id,e=>{e&&"error"in e&&s(l+" Messenger: "+e.error.message,"info",!1,"error-fb")}),Be.whatsapp.check(c)&&Be.whatsapp.send(Be.whatsapp.activeUserPhone(d),a.message,a.attachments,c.get("extra"),e=>{("ErrorCode"in e||"meta"in e&&"success"in e.meta&&!e.meta.success)&&s(l+" WhatsApp: "+("ErrorCode"in e?e.errorMessage:e.meta.developer_message),"info",!1,"error-wa")}),Be.telegram.check(c)&&Be.telegram.send(c.get("extra"),a.message,a.attachments,e=>{"ok"in e&&e.ok||s(l+" Telegram: "+JSON.stringify(e),"info",!1,"error-tg")}),Be.viber.check(c)&&Be.viber.send(d.getExtra("viber-id").value,a.message,a.attachments,e=>{"status_message"in e&&"ok"==e.status_message||s(l+" Viber: "+JSON.stringify(e),"info",!1,"error-vb")}),Be.twitter.check(c)&&Be.twitter.send(d.getExtra("twitter-id").value,a.message,a.attachments,e=>{!e||"event"in e?a.attachments.length>1&&t("Only the first attachment was sent to Twitter.","info"):s(JSON.stringify(e),"info",!1,"error-tw")}),Be.gbm.check(c)&&Be.gbm.send(d.getExtra("gbm-id").value,a.message,a.attachments,e=>{e[0]&&"error"in e[0]&&s(l+" Business Messenger: "+e[0].error.message,"info",!1,"error-bm")}),Be.line.check(c)&&Be.line.send(d.getExtra("line-id").value,a.message,a.attachments,e=>{e.error&&s(l+" LINE: "+JSON.stringify(e),"info",!1,"error-ln")}),Be.wechat.check(c)&&Be.wechat.send(d.getExtra("wechat-id").value,a.message,a.attachments,e=>{e&&"ok"==e.errmsg||s(l+" WeChat: "+JSON.stringify(e),"info",!1,"error-wc")}),SB_ADMIN_SETTINGS["smart-reply"]&&$.html(""),SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SBF.null(c.get("agent_id"))&&Ce.assignAgent(n,SB_ACTIVE_AGENT.id,()=>{SBChat.conversation.id==n&&(SBChat.conversation.set("agent_id",SB_ACTIVE_AGENT.id),e(y).find("#conversation-agent > p").attr("data-value",SB_ACTIVE_AGENT.id).html(SB_ACTIVE_AGENT.full_name))})}),e(document).on("SBNewMessagesReceived",function(e,i){let a=i.get("payload"),n=y.find(".sb-conversation"),r=SBF.isAgent(i.get("user_type"));if(setTimeout(function(){n.find(".sb-top .sb-status-typing").remove()},300),Fe.must_translate){let e=SBChat.conversation.getMessage(i.id),t=n.find(`[data-id="${i.id}"]`),s="original-message"in a&&a["original-message"];s?(e.set("translation",s),t.replaceWith(e.getCode(!0)),n.find(`[data-id="${i.id}"] .sb-menu`).prepend(`<li data-value="original">${o("View translation")}</li>`),SB_ADMIN_SETTINGS["smart-reply"]&&Be.dialogflow.smartReply(s)):i.message&&Be.dialogflow.translate([i.message],SB_ADMIN_SETTINGS["active-agent-language"],s=>{s&&(e.set("translation",s[0]),t.replaceWith(e.getCode(!0)),n.find(`[data-id="${i.id}"] .sb-menu`).prepend(`<li data-value="original">${o("View original message")}</li>`)),SB_ADMIN_SETTINGS["smart-reply"]&&Be.dialogflow.smartReply(s[0])})}else SB_ADMIN_SETTINGS["smart-reply"]&&Be.dialogflow.smartReply(i.message);if("queryResult"in a&&"fulfillmentMessages"in a.queryResult){let e=a.queryResult.fulfillmentMessages;for(var l=0;l<e.length;l++)if("payload"in e[l]){let t=e[l].payload;if("department"in t){Ce.setActiveDepartment(t.department);break}if("agent"in t){Ce.setActiveAgent(t.agent);break}}}"ErrorCode"in a&&s("Error. Message not sent to WhatsApp. Error message: "+a.ErrorMessage,"info"),"whatsapp-templates"in a&&t(`Message sent as text message.${"whatsapp-template-fallback"in a?" The user has been notified via WhatsApp Template notification.":""}`),"whatsapp-template-fallback"in a&&!("whatsapp-templates"in a)&&t("The user has been notified via WhatsApp Template notification."),r||SBChat.conversation.id!=i.get("conversation_id")||SBChat.user_online||Te.setActiveUserStatus(),Ce.update()}),e(document).on("SBNewConversationCreated",function(){Ce.update()}),e(document).on("SBEmailSent",function(){t("The user has been notified by email.")}),e(document).on("SBSMSSent",function(){t("The user has been notified by text message.")}),e(document).on("SBNotificationsSent",function(e,i){t(`The user ${i.includes("cron")?"will be":"has been"} notified by email${i.includes("sms")?" and text message":""}.`)}),e(document).on("SBTyping",function(e,t){Ce.typing(t)}),e(w).on("input",".sb-search-btn input",function(){Ce.search(this)}),e(y).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,()=>{Ce.search(e(this).next())})}),e(y).on("click",".sb-admin-list .sb-select li",function(){let e=x.parent();n(e)||setTimeout(()=>{let t=Ce.filters();ne=1,oe=1,SBF.ajax({function:"get-conversations",status_code:t[0],department:t[1],source:t[2]},i=>{if(Ce.populateList(i),y.find(".sb-conversation").attr("data-conversation-status",t[0]),i.length){if(!de){if(SBChat.conversation){let e=x.find(`[data-conversation-id="${SBChat.conversation.id}"]`);e.length?e.sbActive(!0):t[0]==SBChat.conversation.get("conversation_status_code")?x.prepend(Ce.getListCode(SBChat.conversation).replace("<li",'<li class="sb-active"')):Ce.clickFirst()}else Ce.clickFirst();Ce.scrollTo()}}else y.find(".sb-board").addClass("sb-no-conversation"),SBChat.conversation=!1;e.sbLoading(!1)})},100)}),e(y).on("click",".sb-user-details .sb-scroll-area > .sb-profile,.sb-top > a",function(){let e=x.find(".sb-active").attr("data-user-id");i().id!=e&&i(re[e]),$e.show(i().id)}),e(S).on("click",".sb-profile-list li",function(){let t=e(this).find("label"),n=t.html();switch(e(this).attr("data-id")){case"location":s('<iframe src="https://maps.google.com/maps?q='+n.replace(", ","+")+'&output=embed"></iframe>',"map");break;case"timezone":SBF.getLocationTimeString(i().extra,e=>{a(!1),s(e,"info")});break;case"current_url":window.open("//"+(SBF.null(t.attr("data-value"))?n:t.attr("data-value")));break;case"conversation-source":let o=n.toLowerCase();"whatsapp"==o&&i().getExtra("phone")?window.open("https://wa.me/"+Be.whatsapp.activeUserPhone()):"facebook"==o?window.open("https://www.facebook.com/messages/t/"+SBChat.conversation.get("extra")):"instagram"==o?window.open("https://www.instagram.com/direct/inbox/"):"twitter"==o&&window.open("https://twitter.com/messages/");break;case"wp-id":window.open(window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/user-edit.php?user_id="+i().getExtra("wp-id").value);break;case"envato-purchase-code":a(),SBF.ajax({function:"envato",purchase_code:n},e=>{let t="";e.name=e.item.name;for(var i in e)"string"==typeof e[i]&&(t+=`<b>${SBF.slugToString(i)}</b> ${e[i]} <br>`);a(!1),s(t,"info",!1,"sb-envato-box")})}}),e(y).on("click",'.sb-menu [data-value="bot"]',function(){Be.dialogflow.showCreateIntentBox(e(this).closest("[data-id]").attr("data-id"))}),e(C).on("click",'.sb-intent-add [data-value="add"]',function(){C.find("> div > .sb-type-text").last().after('<div class="sb-input-setting sb-type-text"><input type="text"></div>')}),e(C).on("click",'.sb-intent-add [data-value="previous"],.sb-intent-add [data-value="next"]',function(){let t=C.find(".sb-first input"),i=t.val(),s="next"==e(this).attr("data-value"),a=SBChat.conversation.getUserMessages(),n=a.length;for(var o=0;o<n;o++)if(a[o].message==i&&(s&&o<n-1||!s&&o>0)){o+=s?1:-1,t.val(a[o].message),C.attr("data-message-id",a[o].id),Be.openAI.generateIntents(a[o].message);break}}),e(C).on("click",".sb-send",function(){Be.dialogflow.submitIntent(this)}),e(C).on("input",".sb-search-btn input",function(){Be.dialogflow.searchIntents(e(this).val())}),e(C).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{Be.dialogflow.searchIntents(e(this).val())})}),e(C).on("click","#sb-intent-preview",function(){Be.dialogflow.previewIntent(C.find("#sb-intents-select").val())}),e(C).on("change","#sb-intents-select",function(){C.find(".sb-bot-response").css("opacity",e(this).val()?.5:1)}),e(y).on("click","#conversation-department li",function(t){let i=e(this).parent().parent();return e(this).data("value")==i.find(" > p").attr("data-value")||(SBChat.conversation?(i.sbLoading()||s(`${o("All agents assigned to the new department will be notified. The new department will be")} ${e(this).html()}.`,"alert",()=>{let t=e(this).data("id");i.sbLoading(!0),Ce.assignDepartment(SBChat.conversation.id,t,()=>{Ce.setActiveDepartment(t),i.sbLoading(!1),i.find(" > p").attr("data-value",t)})}),t.preventDefault(),!1):(e(this).parent().sbActive(!1),t.preventDefault(),!1))}),e(y).on("click","#conversation-agent li",function(t){let i=e(this).parent().parent(),a=e(this).data("id");return a==i.find(" > p").attr("data-value")||(SBChat.conversation?(i.sbLoading()||s(`${o("The new agent will be")} ${e(this).html()}.`,"alert",()=>{i.sbLoading(!0),Ce.assignAgent(SBChat.conversation.id,a,()=>{Ce.setActiveAgent(a),i.sbLoading(!1)})}),t.preventDefault(),!1):(e(this).parent().sbActive(!1),t.preventDefault(),!1))}),k.on("click","> i",function(e){return S.find(".sb-notes-box").sbShowLightbox(),e.preventDefault(),!1}),k.on("click",".sb-delete-note",function(){let t=e(this).parents().eq(1);Ce.notes.delete(SBChat.conversation.id,t.attr("data-id"),e=>{!0===e?t.remove():SBF.error(e)})}),e(S).on("click",".sb-add-note",function(){let i=e(this).parent().parents().eq(1).find("textarea"),s=i.val();if(0==s.length)SBForm.showErrorMessage(S.find(".sb-notes-box"),"Please write something...");else{if(n(this))return;s=SBF.escape(s),Ce.notes.add(SBChat.conversation.id,SB_ACTIVE_AGENT.id,SB_ACTIVE_AGENT.full_name,s,a=>{Number.isInteger(a)?(e(this).sbLoading(!1),S.sbHideLightbox(),Ce.notes.update([{id:a,conversation_id:SBChat.conversation.id,user_id:SB_ACTIVE_AGENT.id,name:SB_ACTIVE_AGENT.full_name,message:s}],!0),i.val(""),t("New note successfully added.")):SBForm.showErrorMessage(a)})}}),e($).on("click","span",function(){SBChat.insertText(e(this).html()),$.html("")}),e(y).on("click",".sb-list .sb-menu > li",function(){let t=e(this).closest("[data-id]"),i=t.attr("data-id"),s=SBChat.conversation.getMessage(i).get("user_type"),a=e(this).attr("data-value");switch(a){case"delete":SBChat.user_online?SBF.ajax({function:"update-message",message_id:i,message:"",attachments:[],payload:{event:"delete-message"}},()=>{SBChat.conversation.deleteMessage(i),t.remove()}):SBChat.deleteMessage(i);break;case"translation":case"original":let e="translation"==a,n=SBF.isAgent(s);t.replaceWith(SBChat.conversation.getMessage(i).getCode(e)),y.find(`[data-id="${i}"] .sb-menu`).prepend(`<li data-value="${e?"original":"translation"}">${o(n&&!e||!n&&e?"View original message":"View translation")}</li>`)}}),e(y).on("click",".sb-filter-btn i",function(){e(this).parent().toggleClass("sb-active")}),SBF.getURL("user")&&(_.find(".sb-admin-nav #sb-users").click(),setTimeout(()=>{$e.show(SBF.getURL("user"))},500)),e(L).on("click","th :checkbox",function(){L.find("td :checkbox").prop("checked",e(this).prop("checked"))}),e(L).on("click",":checkbox",function(){let e=I.find('[data-value="delete"]');L.find("td input:checked").length?e.removeAttr("style"):e.hide()}),e(E).on("click","li",function(){Te.filter(e(this).data("type"))}),e(I).on("input",".sb-search-btn input",function(){Te.search(this)}),e(I).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{Te.search(e(this).next())})}),e(L).on("click","th:not(:first-child)",function(){let t=e(this).hasClass("sb-order-asc")?"DESC":"ASC";e(this).toggleClass("sb-order-asc"),e(this).siblings().sbActive(!1),e(this).sbActive(!0),Te.sort(e(this).data("field"),t)}),e(L).parent().on("scroll",function(){!fe&&!Te.search_query&&d(this,!0)&&ce&&(fe=!0,I.append('<div class="sb-loading-global sb-loading sb-loading-pagination"></div>'),SBF.ajax({function:"get-users",pagination:le,sorting:Te.sorting,user_types:Te.user_types,search:Te.search_query,extra:Te.table_extra},e=>{if(setTimeout(()=>{fe=!1},500),ce=e.length){let i="";for(var t=0;t<ce;t++){let s=new SBUser(e[t],e[t].extra);i+=Te.getRow(s),re[s.id]=s}le++,L.find("tbody").append(i),d(this,!1,1e3)}I.find(" > .sb-loading-pagination").remove()}))}),e(M).on("click",".sb-delete",function(){if(SB_ACTIVE_AGENT.id==i().id)return t("You cannot delete yourself.","error");s("This user will be deleted permanently including all linked data, conversations, and messages.","alert",function(){Te.delete(i().id)})}),e(L).on("click","td:not(:first-child)",function(){$e.show(e(this).parent().attr("data-user-id"))}),e(N).on("click",".sb-top-bar .sb-edit",function(){$e.showEdit(i())}),e(I).on("click",".sb-new-user",function(){M.addClass("sb-user-new"),M.find(".sb-top-bar .sb-profile span").html(o("Add new user")),M.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Add user")}`),M.find("input,select,textara").removeClass("sb-error"),M.removeClass("sb-cloud-admin"),"admin"==SB_ACTIVE_AGENT.user_type&&M.find("#user_type").find("select").html(`<option value="user">${o("User")}</option><option value="agent">${o("Agent")}</option><option value="admin">${o("Admin")}</option>`),$e.clear(M),$e.boxClasses(M),$e.updateRequiredFields("user"),M.sbShowLightbox()}),e(M).on("click",".sb-save",function(){if(n(this))return;let s=!!M.hasClass("sb-user-new"),a=M.attr("data-user-id"),o=$e.getAll(M.find(".sb-details")),r=$e.getAll(M.find(".sb-additional-details"));if($e.errors(M))return $e.showErrorMessage(M,SBF.isAgent(M.find("#user_type :selected").val())?"First name, last name, password and a valid email are required. Minimum password length is 8 characters.":"First name and last name are required."),void e(this).sbLoading(!1);SBF.ajax({function:s?"add-user":"update-user",user_id:a,settings:o,settings_extra:r},n=>{if(SBF.errorValidation(n,"duplicate-email")||SBF.errorValidation(n,"duplicate-phone"))return $e.showErrorMessage(M,`This ${SBF.errorValidation(n,"duplicate-email")?"email":"phone number"} is already in use.`),void e(this).sbLoading(!1);s&&(a=n,i(new SBUser({id:a}))),i().update(()=>{re[a]=i(),s?($e.clear(M),Te.update()):(Te.updateRow(i()),y.sbActive()&&Ce.updateUserDetails(),a==SB_ACTIVE_AGENT.id&&(SBF.loginCookie(n[1]),SB_ACTIVE_AGENT.full_name=i().name,SB_ACTIVE_AGENT.profile_image=i().image,_.find(".sb-account").setProfile())),e(this).sbLoading(!1),M.find(".sb-profile").setProfile(),t(s?"New user added":"User updated")}),SBF.event("SBUserUpdated",{new_user:s,user_id:a})})}),e(M).on("change","#user_type",function(){let t=e(this).find("option:selected").val();$e.boxClasses(M,t),$e.updateRequiredFields(t)}),e(N).on("click",".sb-user-conversations li",function(){Ce.open(e(this).attr("data-conversation-id"),i().id)}),e(N).on("click",".sb-start-conversation",function(){Ce.open(-1,i().id),Ce.openConversation(-1,i().id),de&&Ce.mobileOpenConversation()}),e(N).on("click",".sb-top-bar [data-value]",function(){Ce.showDirectMessageBox(e(this).attr("data-value"),[i().id])}),e(I).on("click",".sb-top-bar [data-value]",function(){let i=e(this).data("value"),n=Te.getSelected();switch(i){case"whatsapp":let o=S.find("#sb-whatsapp-send-template-box");a(),SBF.ajax({function:"whatsapp-get-templates"},e=>{let i='<option value=""></option>';if(e.error)return t(e.error.message,"error");for(var s=0;s<e.length;s++)"APPROVED"==e[s].status&&(i+=`<option value="${e[s].name}" data-languages="${e[s].languages}">${e[s].name}</option>`);o.find("#sb-whatsapp-send-template-list").html(i),SBForm.clear(o),o.find(".sb-direct-message-users").val(n.length?n.join(","):"all"),o.find(".sb-bottom > div").html(""),o.find(".sb-loading").sbLoading(!1),a(!1),o.sbShowLightbox()});break;case"message":case"custom_email":case"sms":Ce.showDirectMessageBox(i,n);break;case"csv":Te.csv();break;case"delete":if(n.includes(SB_ACTIVE_AGENT.id))return t("You cannot delete yourself.","error");s("All selected users will be deleted permanently including all linked data, conversations, and messages.","alert",()=>{Te.delete(n),e(this).hide(),L.find("th:first-child input").prop("checked",!1)})}}),e(S).on("click",".sb-send-direct-message",function(){let i=e(this).attr("data-type")?e(this).attr("data-type"):T.attr("data-type"),s="whatsapp"==i,a=s?S.find("#sb-whatsapp-send-template-box"):T,o=a.find(".sb-direct-message-subject input").val(),r=s?"":a.find("textarea").val(),c=a.find(".sb-direct-message-users").val().replace(/ /g,""),d=!!s&&a.find("#sb-whatsapp-send-template-list").val(),u=!!s&&a.find("#sb-whatsapp-send-template-list option:selected").attr("data-languages"),p=!!s&&[a.find("#sb-whatsapp-send-template-header").val(),a.find("#sb-whatsapp-send-template-body").val()];if(SBForm.errors(a))SBForm.showErrorMessage(a,"Please complete the mandatory fields.");else{if(n(this))return;if("message"==i)SBF.ajax({function:"direct-message",user_ids:c,message:r},s=>{e(this).sbLoading(!1);let n=SB_ADMIN_SETTINGS["notify-user-email"],d=SB_ADMIN_SETTINGS["sms-active-users"];if(SBF.errorValidation(s))return SBForm.showErrorMessage(a,"An error has occurred. Please make sure all user ids are correct.");(n||d)&&SBF.ajax({function:"get-users-with-details",user_ids:c,details:n&&d?["email","phone"]:[n?"email":"phone"]},e=>{n&&e.email.length?l(e.email,r,0,d?e.phone:[],"email",o):d&&e.phone.length?l(e.phone,r,0,[],"sms"):S.sbHideLightbox()}),t(`${SBF.slugToString(i)} sent to all users.`)});else{let t="custom_email"==i?"email":"phone";SBF.ajax({function:"get-users-with-details",user_ids:c,details:[t]},s=>{if(!s[t].length)return e(this).sbLoading(!1),SBForm.showErrorMessage(a,"No users found.");l(s[t],r,0,[],i,o,d,p,u)})}}}),SBF.getURL("setting")&&(_.find(".sb-admin-nav #sb-settings").click(),setTimeout(()=>{R.find("#tab-"+SBF.getURL("setting")).click()},300)),e(R).on("click"," > .sb-tab > .sb-nav [id]",function(){let t=e(this).attr("id").substr(4);SBF.getURL("setting")!=t&&u("?setting="+t)}),e(R).on("click",'[data-type="upload-image"] .image, [data-type="upload-file"] .sb-btn',function(){q=this,S.find(".sb-upload-form-admin .sb-upload-files").click()}),e(R).on("click",'[data-type="upload-image"] .image > i',function(t){return e(this).parent().removeAttr("data-value").css("background-image",""),t.preventDefault(),!1}),e(R).on("click",".sb-repeater-add",function(){ke.repeaterAdd(this)}),e(R).on("click",".repeater-item > i",function(){setTimeout(()=>{ke.repeaterDelete(this)},100)}),ke.initColorPicker(),e(R).find('[data-type="color"]').focusout(function(){let t=e(this).closest(".input-color"),i=t.find("input").val();setTimeout(function(){t.find("input").val(""),t.find(".color-preview").css("background-color",i)},300),ke.set(e(this).attr("id"),i)}),e(R).on("click",".sb-type-color .input i",function(t){e(this).parent().find("input").removeAttr("style").val("")}),e(R).on("click",".sb-color-palette span",function(){let t=e(this).hasClass("sb-active");e(this).closest(".sb-repeater").find(".sb-active").sbActive(!1),e(this).sbActive(!t)}),e(R).on("click",".sb-color-palette ul li",function(){e(this).parent().parent().attr("data-value",e(this).data("value")).find("span").sbActive(!1)}),e(R).on("click",'[data-type="select-images"] .input > div',function(){e(this).siblings().sbActive(!1),e(this).sbActive(!0)}),e(R).on("click",".sb-select-checkbox-input",function(){e(this).toggleClass("sb-active")}),e(R).on("click",".sb-select-checkbox input",function(){let t=e(this).closest("[data-type]");t.find(".sb-select-checkbox-input").val(ke.get(t)[1].join(", "))}),e(R).on("click",".sb-save-changes",function(){ke.save(this)}),e(R).on("change",'#user-additional-fields [data-id="extra-field-slug"], #saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){e(this).val(SBF.stringToSlug(e(this).val()))}),e(R).on("click","#timetable-utc input",function(){""==e(this).val()&&e(this).val(Math.round(he.getTimezoneOffset()/60))}),e(R).on("click","#dialogflow-sync-btn .sb-btn",function(e){let t=R.find("#google-client-id input").val();return t&&R.find("#google-client-secret input").val()?window.open(`https://accounts.google.com/o/oauth2/auth?scope=https%3A%2F%2Fwww.googleapis.com/auth/dialogflow%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-translation%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-language&response_type=code&access_type=offline&redirect_uri=${SB_URL}/apps/dialogflow/functions.php&client_id=${t}&prompt=consent`):s("Before continuing enter Client ID and Client secret. Check the docs for more details.","info"),e.preventDefault(),!1}),e(R).on("click","#dialogflow-redirect-url-btn .sb-btn",function(e){return s(`<pre>${SB_URL}/apps/dialogflow/functions.php</pre>`,"info"),e.preventDefault(),!1}),e(R).on("click","#dialogflow-saved-replies .sb-btn",function(t){return s("","alert",()=>{n(this)||SBF.ajax({function:"dialogflow-saved-replies"},()=>{e(this).sbLoading(!1)})}),t.preventDefault(),!1}),e(R).on("click","#test-email-user .sb-btn, #test-email-agent .sb-btn",function(){let t=e(this).parent().find("input").val();t&&t.indexOf("@")>0&&!n(this)&&SBF.ajax({function:"send-test-email",to:t,email_type:"test-email-user"==e(this).parent().parent().attr("id")?"user":"agent"},()=>{s("Your email has been sent!","info"),e(this).sbLoading(!1)})}),e(R).on("click",".sb-timetable > div > div > div",function(){let t=e(this).closest(".sb-timetable"),i=e(this).sbActive();if(e(t).find(".sb-active").sbActive(!1),i)e(this).sbActive(!1).find(".sb-custom-select").remove();else{let i=e(t).find("> .sb-custom-select").html();e(t).find(" > div .sb-custom-select").remove(),e(this).append(`<div class="sb-custom-select">${i}</div>`).sbActive(!0)}}),e(R).on("click",".sb-timetable .sb-custom-select span",function(){let t=[e(this).html(),e(this).attr("data-value")];e(this).closest(".sb-timetable").find("> div > div > .sb-active").html(t[0]).attr("data-value",t[1]),e(this).parent().sbActive(!1)}),e(R).on("click","#system-requirements a",function(e){let t=S.find(".sb-requirements-box"),i="";return SBF.ajax({function:"system-requirements"},e=>{for(var s in e)i+=`<div class="sb-input"><span>${o(SBF.slugToString(s))}</span><div${e[s]?' class="sb-green"':""}>${o(e[s]?"Success":"Error")}</div></div>`;a(!1),t.find(".sb-main").html(i),t.sbShowLightbox()}),t.sbActive(!1),a(!0),e.preventDefault(),!1}),e(R).on("click","#sb-path a",function(e){return SBF.ajax({function:"path"},e=>{s(`<pre>${e}</pre>`,"info")}),e.preventDefault(),!1}),e(R).on("click","#sb-url a",function(e){return s(`<pre>${SB_URL}</pre>`,"info"),e.preventDefault(),!1}),e(R).on("click","#delete-leads a",function(t){return e(this).sbLoading()||s("All leads, including all the linked conversations and messages, will be deleted permanently.","alert",()=>{e(this).sbLoading(!0),SBF.ajax({function:"delete-leads"},()=>{s("Leads and conversations successfully deleted.","info"),e(this).sbLoading(!1)})}),t.preventDefault(),!1}),e(R).on("click","#open-ai-user-expressions-btn a",function(t){return e(this).sbLoading()||s("Make a backup of your Dialogflow agent first. This operation can take several minutes.","alert",()=>{e(this).sbLoading(!0),SBF.ajax({function:"open-ai-user-expressions-intents"},t=>{s("User expressions successfully generated."+(!0===t?"":" Errors: "+t),"info"),e(this).sbLoading(!1)})}),t.preventDefault(),!1}),e(R).on("click","#open-ai-train-btn a",function(e){let t=R.find('[data-id="open-ai-sources-url"], [data-id="open-ai-sources-file-url"]'),i=R.find("#open-ai-mode select"),a=[];if(e.preventDefault(),!t.length||!t[0].value&&(1==t.length||!t[1].value))return s("Please input at least one source for training.","info");if(n(this))return!1;for(var o=0;o<t.length;o++)t[o].value&&a.push(t[o].value);return SBF.ajax({function:"open-ai-get-embeddings-delete",sources:a},()=>{s("<br><br><br><br><br>","info",!1,"sb-embeddings-box"),Be.openAI.crawler.errors=[],Be.openAI.crawler.start_urls=a.slice(),Be.openAI.crawler.start(a)}),i.val()||(i.val("all"),ke.save()),!1}),e(S).on("click","#open-ai-sources-file .repeater-item i, #open-ai-sources-file .repeater-item .sb-btn",function(){let t=e(this).parent().find("input"),i=t.val();i&&(SBF.ajax({function:"delete-file",path:i}),t.val(""))}),e(R).on("click","#sb-export-settings a",function(t){if(!n(this))return SBF.ajax({function:"export-settings"},t=>{window.open(t),s(`${o("For security reasons, delete the settings file after downloading it. Close this window to automatically delete it. File location:")}<pre>${t}</pre>`,"info",!1,"sb-export-settings-close","Settings exported"),e(this).sbLoading(!1)}),t.preventDefault(),!1}),e(R).on("click","#sb-import-settings a",function(i){return q=this,W=(i=>{n(this)||(SBF.ajax({function:"import-settings",file_url:i},i=>{i?t("Settings successfully imported. Reload the admin area to apply the new settings."):s(i,"info"),e(this).sbLoading(!1)}),W=!1)}),S.find(".sb-upload-form-admin .sb-upload-files").click(),i.preventDefault(),!1}),e(S).on("click","#sb-export-settings-close .sb-close",function(){SBF.ajax({function:"delete-file",path:S.find(".sb-dialog-box p pre").html()})}),e(R).on("click","#slack-button .sb-btn",()=>(window.open("https://board.support/synch/?service=slack&plugin_url="+SB_URL+p()),!1)),e(R).on("click","#slack-test .sb-btn",function(t){if(!n(this))return SBF.ajax({function:"send-slack-message",user_id:-1,full_name:SB_ACTIVE_AGENT.full_name,profile_image:SB_ACTIVE_AGENT.profile_image,message:"Lorem ipsum dolor sit amete consectetur adipiscing elite incidido labore et dolore magna aliqua.",attachments:[["Example link",SB_URL+"/media/user.svg"],["Example link two",SB_URL+"/media/user.svg"]]},t=>{SBF.errorValidation(t)?"slack-not-active"==t[1]?s("Please first activate Slack, then save the settings and reload the admin area.","info"):s("Error. Response: "+JSON.stringify(t),"info"):s("success"==t[0]?"Slack message successfully sent. Check your Slack app!":JSON.stringify(t),"info"),e(this).sbLoading(!1)}),t.preventDefault(),!1}),e(R).on("click","#tab-slack",function(){let e=R.find("#slack-agents .input");e.html('<div class="sb-loading"></div>'),SBF.ajax({function:"slack-users"},t=>{let i="";if(SBF.errorValidation(t,"slack-token-not-found"))i=`<p>${o("Synchronize Slack and save changes before linking agents.")}</p>`;else{let e='<option value="-1"></option>';for(s=0;s<t.agents.length;s++)e+=`<option value="${t.agents[s].id}">${t.agents[s].name}</option>`;for(var s=0;s<t.slack_users.length;s++)i+=`<div data-id="${t.slack_users[s].id}"><label>${t.slack_users[s].name}</label><select>${e}</select></div>`}e.html(i),ke.set("slack-agents",[t.saved,"double-select"])})}),e(R).on("click","#slack-archive-channels .sb-btn",function(t){t.preventDefault(),n(this)||SBF.ajax({function:"archive-slack-channels"},t=>{!0===t&&s("Slack channels archived successfully!","info"),e(this).sbLoading(!1)})}),e(R).on("click","#slack-channel-ids .sb-btn",function(t){t.preventDefault(),n(this)||SBF.ajax({function:"slack-channels",code:!0},t=>{s(t,"info",!1,"","",!0),e(this).sbLoading(!1)})}),e(R).on("click","#messenger-button .sb-btn",()=>(window.open("https://board.support/synch/?service=messenger&plugin_url="+SB_URL+p()),!1)),e(R).on("click","#whatsapp-twilio-btn .sb-btn, #sms-btn .sb-btn, #wechat-btn .sb-btn, #twitter-callback .sb-btn, #gbm-webhook .sb-btn, #viber-webhook .sb-btn, #line-webhook .sb-btn",function(t){let i=e(this).closest("[id]").attr("id");return s(`<pre>${SB_URL+("sms-btn"==i?"/include/api.php":"/apps/"+i.substring(0,i.indexOf("-"))+"/post.php")+p().replace("&","?")}</pre>`,"info"),!1}),e(R).on("click","#telegram-button .sb-btn, #viber-button .sb-btn, #whatsapp-360-button .sb-btn",function(t){let i={"telegram-button":["#telegram-token input","telegram-synchronization",["result",!0]],"viber-button":["#viber-token input","viber-synchronization",["status_message","ok"]],"whatsapp-360-button":["#whatsapp-360-key input","whatsapp-360-synchronization",["success",!0]]};i=i[e(this).parent().attr("id")];let a=R.find(i[0]).val().trim();return t.preventDefault(),!(!a||n(this))&&(SBF.ajax({function:i[1],token:a,cloud_token:p()},t=>{s(i[2][0]in t&&t[i[2][0]]==i[2][1]?"Synchronization completed.":JSON.stringify(t),"info"),e(this).sbLoading(!1)}),!1)}),e(R).on("click","#whatsapp-test-template .sb-btn",function(t){t.preventDefault();let i=e(this).parent().find("input").val();if(i&&!n(this))return SBF.ajax({function:"whatsapp-send-template",to:i},t=>{s(t?"error"in t?t.error.message:"Message sent, check your WhatsApp!":t,"info"),e(this).sbLoading(!1)}),!1}),e(R).on("click","#twitter-subscribe .sb-btn",function(t){return t.preventDefault(),!n(this)&&(SBF.ajax({function:"twitter-subscribe",cloud_token:p()},t=>{s(!0===t?"Synchronization completed.":JSON.stringify(t),"info"),e(this).sbLoading(!1)}),!1)}),e(R).on("click","#wp-sync .sb-btn",function(t){return t.preventDefault(),!n(this)&&(Be.wordpress.ajax("wp-sync",{},t=>{!0===t||"1"===t?(Te.update(),s("WordPress users successfully imported.","info")):s("Error. Response: "+JSON.stringify(t),"info"),e(this).sbLoading(!1)}),!1)}),e("body").on("click","#wp-admin-bar-logout",function(){SBF.logout(!1)}),e(R).on("click","#tab-translations",function(){let e=R.find(".sb-translations > .sb-nav > ul");if(""==e.html()){let i="";for(var t in SB_LANGUAGE_CODES)"en"!=t&&(i+=`<li data-code="${t}"><img src="${SB_URL}/media/flags/${t}.png" />${SB_LANGUAGE_CODES[t]}</li>`);e.html(i)}}),e(R).on("click",".sb-translations .sb-nav li",function(){ke.translations.load(e(this).data("code"))}),e(R).on("click",".sb-translations .sb-menu-wide li",function(){R.find(`.sb-translations [data-area="${e(this).data("value")}"]`).sbActive(!0).siblings().sbActive(!1)}),e(R).on("click",".sb-add-translation",function(){R.find(".sb-translations-list > .sb-active").prepend(`<div class="sb-input-setting sb-type-text sb-new-translation"><input type="text" placeholder="${o("Enter original text...")}"><input type="text" placeholder="${o("Enter translation...")}"></div></div>`)}),e(R).on("input",".sb-search-translation input",function(){let t=e(this).val().toLowerCase();SBF.search(t,()=>{t.length>1&&R.find(".sb-translations .sb-content > .sb-active label").each(function(){let i=e(this).html().toLowerCase();if(i.includes(t)&&i!=Z){let t=R.find(".sb-scroll-area");return t[0].scrollTop=0,t[0].scrollTop=e(this).position().top-80,Z=i,!1}})})}),e(R).on("click","#tab-articles",function(){D.find(".sb-menu-wide li").eq(0).sbActive(!0).next().sbActive(!1),ke.articles.get(e=>{ke.articles.populate(e[0]),ke.articles.categories=e[1],ke.articles.translations=Array.isArray(e[2])&&!e[2].length?{}:e[2],ke.articles.updateSelect(),a(!1)},!0),a()}),e(D).on("click",'.sb-nav:not([data-type="categories"]) li',function(){ke.articles.show(e(this).attr("data-id"),this),R.find(".sb-scroll-area").scrollTop(0)}),e(D).on("click",".sb-add-article",function(){ke.articles.add()}),e(D).on("click",".sb-add-category",function(){ke.articles.addCategory(!1,"categories"==e(this).data("type"))}),e(D).on("click",".sb-nav i",function(){let t=e(this).hasClass("sb-category");s(`The ${t?"category":"article"} will be deleted permanently.`,"alert",()=>{ke.articles.delete(this,t)})}),e(D).on("click",".sb-menu-wide li",function(){ke.articles.populate(!1,"categories"==e(this).data("type"))}),e(R).on("click","#email-piping-sync a",function(t){n(this)||(SBF.ajax({function:"email-piping",force:!0},t=>{s(!0===t?"Syncronization completed.":t,"info"),e(this).sbLoading(!1)}),t.preventDefault())}),e(R).on("click","#tab-automations",function(){ke.automations.get(()=>{ke.automations.populate(),a(!1)},!0),a()}),e(G).on("click",".sb-add-condition",function(){ke.automations.addCondition()}),e(G).on("change",".sb-condition-1 select",function(){ke.automations.updateCondition(this)}),e(P).on("click","li",function(){ke.automations.populate(e(this).data("value"))}),e(O).on("click","li",function(){ke.automations.show(e(this).attr("data-id"))}),e(G).on("click",".sb-add-automation",function(){ke.automations.add()}),e(O).on("click","li i",function(){s("The automation will be deleted permanently.","alert",()=>{ke.automations.delete(this)})}),e(V).on("click",".sb-nav [id]",function(){let t=e(this).attr("id");Ae.active_report=!1,V.find("#sb-date-picker").val(""),V.attr("class","sb-area-reports sb-active sb-report-"+t),Ae.initReport(e(this).attr("id")),SBF.getURL("report")!=t&&u("?report="+t)}),e(V).on("change","#sb-date-picker",function(){Ae.initReport(!1,e(this).val())}),SBF.getURL("report")&&(V.sbActive()||_.find(".sb-admin-nav #sb-reports").click(),setTimeout(()=>{V.find("#"+SBF.getURL("report")).click()},500)),e(y).on("click",".sb-panel-woocommerce > i",function(){Be.woocommerce.conversationPanel()}),e(y).on("click",".sb-woocommerce-orders > div > span",function(t){let i=e(this).parent();e(t.target).is("span")&&(i.sbActive()||Be.woocommerce.conversationPanelOrder(i.attr("data-id")))}),e(y).on("click",".sb-btn-woocommerce",function(){(ae.sbLoading()||0!=i()&&i().language!=Be.woocommerce.popupLanguage)&&Be.woocommerce.popupPopulate(),se.find(".sb-search-btn input").val(""),se.sbTogglePopup(this)}),e(se).find(".sb-woocommerce-products-list").on("scroll",function(){d(this,!0)&&Be.woocommerce.popupPagination(this)}),e(se).on("click",".sb-select li",function(){Be.woocommerce.popupFilter(this)}),e(se).on("input",".sb-search-btn input",function(){Be.woocommerce.popupSearch(this)}),e(se).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{Be.woocommerce.popupSearch(e(this).next())})}),e(se).on("click",".sb-woocommerce-products-list li",function(){let t=se.attr("data-action"),i=e(this).data("id");SBF.null(t)?SBChat.insertText(`{product_card id="${i}"}`):(ae.sbLoading(!0),y.find(".sb-add-cart-btn").sbLoading(!0),SBChat.sendMessage(-1,"",[],e=>{e&&(Be.woocommerce.conversationPanelUpdate(i),S.sbHideLightbox())},{event:"woocommerce-update-cart",action:"cart-add",id:i})),SBF.deactivateAll(),S.removeClass("sb-popup-active")}),e(y).on("click",".sb-panel-woocommerce .sb-add-cart-btn",function(){e(this).sbLoading()||(SBChat.user_online?(Be.woocommerce.popupPopulate(),se.sbShowLightbox(!0,"cart-add")):s("The user is offline. Only the carts of online users can be updated.","info"))}),e(y).on("click",".sb-panel-woocommerce .sb-list-items > a > i",function(t){let i=e(this).parent().attr("data-id");return SBChat.sendMessage(-1,"",[],()=>{Be.woocommerce.conversationPanelUpdate(i,"removed")},{event:"woocommerce-update-cart",action:"cart-remove",id:i}),e(this).sbLoading(!0),t.preventDefault(),!1}),e(R).on("click","#wc-dialogflow-synch a, #wc-dialogflow-create-intents a",function(t){if(Be.is("dialogflow")){if(n(this))return;let t=e(this).parent().attr("id");SBF.ajax({function:"woocommerce-dialogflow-"+("wc-dialogflow-synch"==t?"entities":"intents")},t=>{e(this).sbLoading(!1),s(t?"Synchronization completed.":"Error. Something went wrong.","info")})}else s("This feature requires the Dialogflow App. Get it from the apps area.","info");return t.preventDefault(),!1}),e(y).on("click",".sb-panel-ump > i",function(){Be.ump.conversationPanel()}),e(y).on("click",".sb-panel-armember > i",function(){Be.armember.conversationPanel()}),e(R).on("click","#perfex-sync .sb-btn, #whmcs-sync .sb-btn,#perfex-articles-sync .sb-btn, #whmcs-articles-sync .sb-btn, #aecommerce-sync .sb-btn, #aecommerce-sync-admins .sb-btn, #aecommerce-sync-sellers .sb-btn, #martfury-sync .sb-btn, #martfury-sync-sellers .sb-btn",function(t){if(n(this))return;let i=e(this).closest("[id]").attr("id"),a=i.indexOf("article")>0;SBF.ajax({function:i},t=>{!0===t?(a||Te.update(),s(a?"Knowledge base articles successfully imported.":"Users successfully imported.","info")):s("Error. Response: "+JSON.stringify(t),"info"),e(this).sbLoading(!1)}),t.preventDefault()}),e(y).on("click","#sb-zendesk-btn",function(t){n(this)||(SBF.ajax({function:"zendesk-create-ticket",conversation_id:SBChat.conversation.id},t=>{!0===t?Be.zendesk.conversationPanel():s("Error. Response: "+JSON.stringify(t),"info"),e(this).sbLoading(!1)}),t.preventDefault())}),e(y).on("click","#sb-zendesk-update-ticket",function(t){if(!n(this))return SBF.ajax({function:"zendesk-update-ticket",conversation_id:SBChat.conversation.id,zendesk_ticket_id:e(this).closest("[data-id]").attr("data-id")},()=>{e(this).sbLoading(!1)}),t.preventDefault(),!1}),e(S).on("click",".sb-language-switcher > i",function(){let t=e(this).parent(),i=t.find("[data-language]").map(function(){return e(this).attr("data-language")}).get(),s=S.find(".sb-languages-box"),a="";i.push("en");for(var n in SB_LANGUAGE_CODES)i.includes(n)||(a+=`<div data-language="${n}"><img src="${SB_URL}/media/flags/${n}.png" />${o(SB_LANGUAGE_CODES[n])}</div>`);z=t,s.attr("data-source",t.attr("data-source")),s.find(".sb-main").html(a),s.sbShowLightbox()}),e(S).on("click",".sb-language-switcher img",function(){let t=e(this).parent(),i=t.sbActive(),s=!i&&t.attr("data-language");switch(t.parent().attr("data-source")){case"articles":ke.articles.show(!1,!1,s);break;case"automations":ke.automations.show(!1,s);break;case"settings":let e=t.parent().find("[data-language].sb-active");ke.translations.save(t,i?t.attr("data-language"):!!e.length&&e.attr("data-language")),ke.translations.activate(t,s)}t.siblings().sbActive(!1),t.sbActive(!i)}),e(S).on("click",".sb-language-switcher span > i",function(){let t=e(this).parent(),i=t.attr("data-language");s(o("The {T} translation will be deleted.").replace("{T}",o(SB_LANGUAGE_CODES[i])),"alert",()=>{switch(t.parent().attr("data-source")){case"articles":ke.articles.deleteTranslation(!1,i),ke.articles.show();break;case"automations":ke.automations.deleteTranslation(!1,i),ke.automations.show();break;case"settings":ke.translations.delete(t,i)}t.remove()})}),e(S).on("click",".sb-languages-box [data-language]",function(){let t=e(this).parents().eq(1),i=e(this).attr("data-language");switch(t.attr("data-source")){case"articles":ke.articles.addTranslation(!1,i),ke.articles.show(!1,!1,i);break;case"automations":ke.automations.addTranslation(!1,!1,i),ke.automations.show(!1,i);break;case"settings":ke.translations.add(i)}S.sbHideLightbox()}),e(S).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){S.sbHideLightbox()}),e(S).on("click",".sb-lightbox .sb-info",function(){e(this).sbActive(!1)}),e(S).on("click",".sb-dialog-box a",function(){let t=e(this).closest(".sb-lightbox");e(this).hasClass("sb-confirm")&&X(),1==S.find(".sb-lightbox.sb-active").length&&K.sbActive(!1),Fe.open_popup=!1,t.sbActive(!1)}),e(S).on("click",".sb-menu-wide li, .sb-nav li",function(){e(this).siblings().sbActive(!1),e(this).sbActive(!0)}),e(S).on("click",".sb-nav:not(.sb-nav-only) li:not(.sb-tab-nav-title)",function(){let t=e(this).closest(".sb-tab"),i=e(t).find(" > .sb-content > div").sbActive(!1).eq(e(this).parent().find("li:not(.sb-tab-nav-title)").index(this));i.sbActive(!0),i.find("textarea").each(function(){e(this).autoExpandTextarea(),e(this).manualExpandTextarea()}),t.find(".sb-scroll-area").scrollTop(0)}),e(S).sbInitTooltips(),e(S).on("click",'[data-button="toggle"]',function(){let t=S.find("."+e(this).data("show")),i=S.find("."+e(this).data("hide"));t.addClass("sb-show-animation").show(),i.hide(),Fe.open_popup=!(!t.hasClass("sb-lightbox")&&!t.hasClass("sb-popup"))&&t}),e(S).on("click",".sb-info-card",function(){e(this).sbActive(!1)}),e(S).on("change",".sb-upload-form-admin .sb-upload-files",function(){e(this).sbUploadFiles(function(t){if("success"==(t=JSON.parse(t))[0]){let i=e(q).closest("[data-type]").data("type");"upload-image"==i&&e(q).attr("data-value",t[1]).css("background-image",`url("${t[1]}")`),"upload-file"==i&&e(q).parent().find("input").val(t[1]),W&&W(t[1])}else console.log(t[1])})}),e(S).on("click",".sb-accordion > div > span",function(t){let i=e(this).parent(),s=e(i).sbActive();e(t.target).is("span")&&(i.siblings().sbActive(!1),i.sbActive(!s))}),e(S).on("mousedown",function(t){if(e(Fe.open_popup).length){let i=e(Fe.open_popup);i.is(t.target)||0!==i.has(t.target).length||["sb-btn-saved-replies","sb-btn-emoji","sb-btn-woocommerce","sb-btn-open-ai"].includes(e(t.target).attr("class"))||(i.hasClass("sb-popup")?i.sbTogglePopup():i.hasClass("sb-select")?i.find("ul").sbActive(!1):i.hasClass("sb-menu-mobile")?i.find("i").sbActive(!1):i.hasClass("sb-menu")?i.sbActive(!1):Fe.open_popup&&["sb-embeddings-box"].includes(Fe.open_popup.attr("id"))||S.sbHideLightbox(),Fe.open_popup=!1)}})})}(jQuery),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("colors",[],function(){return t(e)}):e.Colors=t(e)}(this,function(e,t){function i(e,i,a,n,o){if("string"==typeof i){a=(i=v.txt2color(i)).type,p[a]=i[a],o=o!==t?o:i.alpha}else if(i)for(var c in i)e[a][c]=r(i[c]/l[a][c][1],0,1);return o!==t&&(e.alpha=r(+o,0,1)),s(a,n?e:t)}function s(e,t){var i,s,r,h=t||p,f=v,b=u.options,g=l,m=h.RND,S="",_="",y={hsl:"hsv",rgb:e},w=m.rgb;if("alpha"!==e){for(var x in g)if(!g[x][x]){e!==x&&(_=y[x]||"rgb",h[x]=f[_+"2"+x](h[_])),m[x]||(m[x]={}),i=h[x];for(S in i)m[x][S]=d(i[S]*g[x][S][1])}w=m.rgb,h.HEX=f.RGB2HEX(w),h.equivalentGrey=b.grey.r*h.rgb.r+b.grey.g*h.rgb.g+b.grey.b*h.rgb.b,h.webSave=s=a(w,51),h.webSmart=r=a(w,17),h.saveColor=w.r===s.r&&w.g===s.g&&w.b===s.b?"web save":w.r===r.r&&w.g===r.g&&w.b===r.b?"web smart":"",h.hueRGB=v.hue2RGB(h.hsv.h),t&&(h.background=function(e,t,i){var s=u.options.grey,a={};return a.RGB={r:e.r,g:e.g,b:e.b},a.rgb={r:t.r,g:t.g,b:t.b},a.alpha=i,a.equivalentGrey=d(s.r*e.r+s.g*e.g+s.b*e.b),a.rgbaMixBlack=o(t,{r:0,g:0,b:0},i,1),a.rgbaMixWhite=o(t,{r:1,g:1,b:1},i,1),a.rgbaMixBlack.luminance=n(a.rgbaMixBlack,!0),a.rgbaMixWhite.luminance=n(a.rgbaMixWhite,!0),u.options.customBG&&(a.rgbaMixCustom=o(t,u.options.customBG,i,1),a.rgbaMixCustom.luminance=n(a.rgbaMixCustom,!0),u.options.customBG.luminance=n(u.options.customBG,!0)),a}(w,h.rgb,h.alpha))}var B,k,A,T=h.rgb,C=h.alpha,$="luminance",F=h.background;return B=o(T,{r:0,g:0,b:0},C,1),B[$]=n(B,!0),h.rgbaMixBlack=B,k=o(T,{r:1,g:1,b:1},C,1),k[$]=n(k,!0),h.rgbaMixWhite=k,b.customBG&&(A=o(T,F.rgbaMixCustom,C,1),A[$]=n(A,!0),A.WCAG2Ratio=function(e,t){var i=1;return i=e>=t?(e+.05)/(t+.05):(t+.05)/(e+.05),d(100*i)/100}(A[$],F.rgbaMixCustom[$]),h.rgbaMixBGMixCustom=A,A.luminanceDelta=c.abs(A[$]-F.rgbaMixCustom[$]),A.hueDelta=function(e,t,i){return(c.max(e.r-t.r,t.r-e.r)+c.max(e.g-t.g,t.g-e.g)+c.max(e.b-t.b,t.b-e.b))*(i?255:1)/765}(F.rgbaMixCustom,A,!0)),h.RGBLuminance=n(w),h.HUELuminance=n(h.hueRGB),b.convertCallback&&b.convertCallback(h,e),h}function a(e,t){var i={},s=0,a=t/2;for(var n in e)s=e[n]%t,i[n]=e[n]+(s>a?t-s:-s);return i}function n(e,t){for(var i=t?1:255,s=[e.r/i,e.g/i,e.b/i],a=u.options.luminance,n=s.length;n--;)s[n]=s[n]<=.03928?s[n]/12.92:c.pow((s[n]+.055)/1.055,2.4);return a.r*s[0]+a.g*s[1]+a.b*s[2]}function o(e,i,s,a){var n={},o=s!==t?s:1,r=a!==t?a:1,l=o+r*(1-o);for(var c in e)n[c]=(e[c]*o+i[c]*r*(1-o))/l;return n.a=l,n}function r(e,t,i){return e>i?i:t>e?t:e}var l={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},c=e.Math,d=c.round,u={},p={},h={r:.298954,g:.586434,b:.114612},f={r:.2126,g:.7152,b:.0722},b=function(e){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:h,luminance:f,valueRanges:l},g(this,e||{})},g=function(e,s){var a,n=e.options;m(e);for(var o in s)s[o]!==t&&(n[o]=s[o]);a=n.customBG,n.customBG="string"==typeof a?v.txt2color(a).rgb:a,p=i(e.colors,n.color,t,!0)},m=function(e){u!==e&&(u=e,p=e.colors)};b.prototype.setColor=function(e,a,n){return m(this),e?i(this.colors,e,a,t,n):(n!==t&&(this.colors.alpha=r(n,0,1)),s(a))},b.prototype.setCustomBackground=function(e){return m(this),this.options.customBG="string"==typeof e?v.txt2color(e).rgb:e,i(this.colors,t,"rgb")},b.prototype.saveAsBackground=function(){return m(this),i(this.colors,t,"rgb",!0)},b.prototype.toString=function(e,t){return v.color2text((e||"rgb").toLowerCase(),this.colors,t)};var v={txt2color:function(e){var t={},i=e.replace(/(?:#|\)|%)/g,"").split("("),s=(i[1]||"").split(/,\s*/),a=i[1]?i[0].substr(0,3):"rgb",n="";if(t.type=a,t[a]={},i[1])for(var o=3;o--;)n=a[o]||a.charAt(o),t[a][n]=+s[o]/l[a][n][1];else t.rgb=v.HEX2rgb(i[0]);return t.alpha=s[3]?+s[3]:1,t},color2text:function(e,t,i){var s=!1!==i&&d(100*t.alpha)/100,a="number"==typeof s&&!1!==i&&(i||1!==s),n=t.RND.rgb,o=t.RND.hsl,r="hex"===e&&a,l="hex"===e&&!r,c="rgb"===e||r?n.r+", "+n.g+", "+n.b:l?"#"+t.HEX:o.h+", "+o.s+"%, "+o.l+"%";return l?c:(r?"rgb":e)+(a?"a":"")+"("+c+(a?", "+s:"")+")"},RGB2HEX:function(e){return((e.r<16?"0":"")+e.r.toString(16)+(e.g<16?"0":"")+e.g.toString(16)+(e.b<16?"0":"")+e.b.toString(16)).toUpperCase()},HEX2rgb:function(e){return e=e.split(""),{r:+("0x"+e[0]+e[e[3]?1:0])/255,g:+("0x"+e[e[3]?2:1]+(e[3]||e[1]))/255,b:+("0x"+(e[4]||e[2])+(e[5]||e[2]))/255}},hue2RGB:function(e){var t=6*e,i=~~t%6,s=6===t?0:t-i;return{r:d(255*[1,1-s,0,0,s,1][i]),g:d(255*[s,1,1,1-s,0,0][i]),b:d(255*[0,0,s,1,1,1-s][i])}},rgb2hsv:function(e){var t,i,s,a=e.r,n=e.g,o=e.b,r=0;return o>n&&(n=o+(o=n,0),r=-1),i=o,n>a&&(a=n+(n=a,0),r=-2/6-r,i=c.min(n,o)),t=a-i,s=a?t/a:0,{h:1e-15>s?p&&p.hsl&&p.hsl.h||0:t?c.abs(r+(n-o)/(6*t)):0,s:a?t/a:p&&p.hsv&&p.hsv.s||0,v:a}},hsv2rgb:function(e){var t=6*e.h,i=e.s,s=e.v,a=~~t,n=t-a,o=s*(1-i),r=s*(1-n*i),l=s*(1-(1-n)*i),c=a%6;return{r:[s,r,o,o,l,s][c],g:[l,s,s,r,o,o][c],b:[o,o,l,s,s,r][c]}},hsv2hsl:function(e){var t=(2-e.s)*e.v,i=e.s*e.v;return i=e.s?1>t?t?i/t:0:i/(2-t):0,{h:e.h,s:e.v||i?i:p&&p.hsl&&p.hsl.s||0,l:t/2}},rgb2hsl:function(e,t){var i=v.rgb2hsv(e);return v.hsv2hsl(t?i:p.hsv=i)},hsl2rgb:function(e){var t=6*e.h,i=e.s,s=e.l,a=.5>s?s*(1+i):s+i-i*s,n=s+s-a,o=~~t,r=a*(a?(a-n)/a:0)*(t-o),l=n+r,c=a-r,d=o%6;return{r:[a,c,n,n,l,a][d],g:[l,a,a,c,n,n][d],b:[n,n,l,a,a,c][d]}}};return b}),function(e,t){"object"==typeof exports?module.exports=t(e,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(i,s){return t(e,i,s)}):t(e,e.jQuery,e.Colors)}(this,function(e,t,i,s){function a(e){return e.value||e.getAttribute("value")||t(e).css("background-color")||"#FFF"}function n(e){return(e=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0]:e).originalEvent?e.originalEvent:e}function o(e){return t(e.find(f.doRender)[0]||e[0])}function r(i){var s=t(this),n=s.offset(),r=t(e),u=f.gap;i?(b=o(s),b._colorMode=b.data("colorMode"),p.$trigger=s,(g||l()).css(f.positionCallback.call(p,s)||{left:(g._left=n.left)-((g._left+=g._width-(r.scrollLeft()+r.width()))+u>0?g._left+u:0),top:(g._top=n.top+s.outerHeight())-((g._top+=g._height-(r.scrollTop()+r.height()))+u>0?g._top+u:0)}).show(f.animationSpeed,function(){!0!==i&&(y.toggle(!!f.opacity)._width=y.width(),v._width=v.width(),v._height=v.height(),m._height=m.height(),h.setColor(a(b[0])),d(!0))}).off(".tcp").on(A,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):p.$trigger&&t(g).hide(f.animationSpeed,function(){d(!1),p.$trigger=null}).off(".tcp")}function l(){return t("head")[f.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(f.css||I)+(f.cssAddon||"")+"</style>"),t(F).css({margin:f.margin}).appendTo("body").show(0,function(){p.$UI=g=t(this),C=f.GPU&&g.css("perspective")!==s,m=t(".cp-z-slider",this),v=t(".cp-xy-slider",this),S=t(".cp-xy-cursor",this),_=t(".cp-z-cursor",this),y=t(".cp-alpha",this),w=t(".cp-alpha-cursor",this),f.buildCallback.call(p,g),g.prepend("<div>").children().eq(0).css("width",g.children().eq(0).width()),g._width=this.offsetWidth,g._height=this.offsetHeight}).hide()}function c(e){var i=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");(e.button||e.which)>1||(e.preventDefault&&e.preventDefault(),e.returnValue=!1,b._offset=t(this).offset(),(i="xy_slider"===i?function(e){var t=n(e),i=t.pageX-b._offset.left,s=t.pageY-b._offset.top;h.setColor({s:i/v._width*100,v:100-s/v._height*100},"hsv")}:"z_slider"===i?function(e){var t=n(e).pageY-b._offset.top;h.setColor({h:360-t/m._height*360},"hsv")}:function(e){var t=(n(e).pageX-b._offset.left)/y._width;h.setColor({},"rgb",t)})(e),d(),x.on(T,function(){x.off(".tcp")}).on(k,function(e){i(e),d()}))}function d(e){var t=h.colors,i=t.hueRGB,a=(t.RND.rgb,t.RND.hsl,f.dark),n=f.light,o=h.toString(b._colorMode,f.forceAlpha),r=t.HUELuminance>.22?a:n,l=t.rgbaMixBlack.luminance>.22?a:n,c=(1-t.hsv.h)*m._height,d=t.hsv.s*v._width,p=(1-t.hsv.v)*v._height,g=t.alpha*y._width,x=C?"translate3d":"",B=b[0].value,k=b[0].hasAttribute("value")&&""===B&&e!==s;v._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},S._css={transform:x+"("+d+"px, "+p+"px, 0)",left:C?"":d,top:C?"":p,borderColor:t.RGBLuminance>.22?a:n},_._css={transform:x+"(0, "+c+"px, 0)",top:C?"":c,borderColor:"transparent "+r},y._css={backgroundColor:"#"+t.HEX},w._css={transform:x+"("+g+"px, 0, 0)",left:C?"":g,borderColor:l+" transparent"},b._css={backgroundColor:k?"":o,color:k?"":t.rgbaMixBGMixCustom.luminance>.22?a:n},b.text=k?"":B!==o?o:"",e!==s?u(e):$(u)}function u(e){v.css(v._css),S.css(S._css),_.css(_._css),y.css(y._css),w.css(w._css),f.doRender&&b.css(b._css),b.text&&b.val(b.text),f.renderCallback.call(p,b,"boolean"==typeof e?e:s)}var p,h,f,b,g,m,v,S,_,y,w,x=t(document),B=t(),k="touchmove.tcp mousemove.tcp pointermove.tcp",A="touchstart.tcp mousedown.tcp pointerdown.tcp",T="touchend.tcp mouseup.tcp pointerup.tcp",C=!1,$=e.requestAnimationFrame||e.webkitRequestAnimationFrame||function(e){e()},F='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',I=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",L=function(e){h=this.color=new i(e),f=h.options,p=this};L.prototype={render:d,toggle:r},t.fn.colorPicker=function(i){var s=this,n=function(){};return i=t.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:n,buildCallback:n,positionCallback:n,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},i),!p&&i.scrollResize&&t(e).on("resize.tcp scroll.tcp",function(){p.$trigger&&p.toggle.call(p.$trigger[0],!0)}),B=B.add(this),this.colorPicker=p||new L(i),this.options=i,t(i.body).off(".tcp").on(A,function(e){-1===B.add(g).add(t(g).find(e.target)).index(e.target)&&r()}),this.on("focusin.tcp click.tcp",function(e){p.color.options=t.extend(p.color.options,f=s.options),r.call(this,e)}).on("change.tcp",function(){h.setColor(this.value||"#FFF"),s.colorPicker.render(!0)}).each(function(){var e=a(this),s=e.split("("),n=o(t(this));n.data("colorMode",s[1]?s[0].substr(0,3):"HEX").attr("readonly",f.preventFocus),i.doRender&&n.css({"background-color":e,color:function(){return h.setColor(e).rgbaMixBGMixCustom.luminance>.22?i.dark:i.light}})})},t.fn.colorPicker.destroy=function(){t("*").off(".tcp"),p.toggle(!1),B=t()}});